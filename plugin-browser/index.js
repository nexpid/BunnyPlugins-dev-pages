(function(exports,plugin,metro,common,_vendetta,assets,toasts,ui,components,patcher$1,utils,plugins){"use strict";var _findByProps$1,_findByProps1,_findByProps2,_findByProps3,_findByProps4;const ThemeStore=metro.findByStoreName("ThemeStore");metro.findByProps("triggerHaptic");const colorModule=metro.findByProps("colors","unsafe_rawColors"),colorResolver=colorModule?.internal??colorModule?.meta,TextStyleSheet=metro.findByProps("TextStyleSheet").TextStyleSheet,ActionSheet=((_findByProps$1=metro.findByProps("ActionSheet"))===null||_findByProps$1===void 0?void 0:_findByProps$1.ActionSheet)??metro.find(function(x){var _x_render;return((_x_render=x.render)===null||_x_render===void 0?void 0:_x_render.name)==="ActionSheet"}),LazyActionSheet=metro.findByProps("openLazy","hideActionSheet"),{openLazy,hideActionSheet:hideActionSheet$1}=LazyActionSheet,{ActionSheetTitleHeader,ActionSheetCloseButton,ActionSheetContentContainer}=metro.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");(_findByProps1=metro.findByProps("ActionSheetRow"))===null||_findByProps1===void 0||_findByProps1.ActionSheetRow,metro.findByName("Navigator")??((_findByProps2=metro.findByProps("Navigator"))===null||_findByProps2===void 0||_findByProps2.Navigator),((_findByProps3=metro.findByProps("getRenderCloseButton"))===null||_findByProps3===void 0?void 0:_findByProps3.getRenderCloseButton)??((_findByProps4=metro.findByProps("getHeaderCloseButton"))===null||_findByProps4===void 0||_findByProps4.getHeaderCloseButton),metro.findByProps("popModal","pushModal");const lerp=function(og,target,perc){const hex2rgb=function(hex){var _hex_match;return((_hex_match=hex.match(/\w\w/g))===null||_hex_match===void 0?void 0:_hex_match.map(function(x){return parseInt(x,16)}))??[0,0,0]},rgb2hex=function(rgb){return`#${rgb.map(function(x){return x.toString(16).padStart(2,"0")}).join("")}`},ogR=hex2rgb(og),targetR=hex2rgb(target),result=ogR.map(function(ogC,i){return Math.round(ogC+(targetR[i]-ogC)*perc)});return rgb2hex(result)};function resolveSemanticColor(color){let theme=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ThemeStore.theme;return colorResolver.resolveSemanticColor(theme,color)}function openSheet(sheet,props){try{openLazy(new Promise(function(x){return x({default:sheet})}),"ActionSheet",props)}catch(e){_vendetta.logger.error(e.stack),toasts.showToast("Got error when opening ActionSheet! Please check debug logs",assets.getAssetIDByName("Smal"))}}function fluxSubscribe(topic,callback){return common.FluxDispatcher.subscribe(topic,callback),function(){return common.FluxDispatcher.unsubscribe(topic,callback)}}metro.find(function(x){return x?.WebView&&!x.default}).WebView,metro.findByProps("SvgXml"),metro.findByProps("isJoi");const Reanimated=metro.findByProps("useSharedValue"),FlashList=metro.findByProps("FlashList").FlashList,zustand={create:metro.findByName("create")},RNMMKVManager=common.ReactNative.NativeModules.MMKVManager,RNFileManager=common.ReactNative.NativeModules.DCDFileManager??common.ReactNative.NativeModules.RTNFileManager;common.ReactNative.NativeModules.BundleUpdaterManager,common.ReactNative.NativeModules.DCDSoundManager;const RNFSManager=common.ReactNative.NativeModules.RNFSManager,normalizeFilePath=function(path){return path.startsWith("file://")?path.slice(7):path},getOptions=function(encoding){if(typeof encoding=="string"){if(["utf8","ascii","base64"].includes(encoding))return{encoding};throw new Error(`Invalid encoding type "${String(encoding)}"`)}else return encoding||{encoding:"utf8"}},readFileGeneric=function(filepath,encoding,command){const options=getOptions(encoding);return command(normalizeFilePath(filepath)).then(function(b64){let contents;return options.encoding==="utf8"?contents=Buffer.from(b64,"base64").toString("utf8"):options.encoding==="ascii"?contents=Buffer.from(b64,"base64").toString("ascii"):options.encoding==="base64"&&(contents=b64),contents})},resolveWrite=function(filepath){let write={style:null,path:null};const constants2=RNFileManager.getConstants();if(filepath.startsWith(constants2.DocumentsDirPath))write={style:"documents",path:filepath.slice(constants2.DocumentsDirPath.length+1)};else if(filepath.startsWith(constants2.CacheDirPath))write={style:"cache",path:filepath.slice(constants2.CacheDirPath.length+1)};else throw new Error(`File path "${String(filepath)}" is unsupported on versions <211.6 (not a caches/documents path, missing RNFS)`);return write},RNFS={unlink(filepath){if(RNFSManager)return RNFSManager.unlink(normalizeFilePath(filepath)).then(function(){});const write=resolveWrite(filepath);return RNFileManager.removeFile(write.style,write.path).then(function(){})},exists(filepath){return RNFSManager?RNFSManager.exists(normalizeFilePath(filepath)):RNFileManager.fileExists(normalizeFilePath(filepath))},readFile(filepath,encoding){if(RNFSManager)return readFileGeneric(filepath,encoding,RNFSManager.readFile);{const options=getOptions(encoding);if(options.encoding==="ascii")throw new Error('Encoding type "ascii" is unsupported on versions <211.6 (missing RNFS)');return RNFileManager.readFile(filepath,options.encoding)}},writeFile(filepath,contents,encoding){const options=getOptions(encoding);if(!RNFSManager){if(options.encoding==="ascii")throw new Error('Encoding type "ascii" is unsupported on versions <211.6 (missing RNFS)');const write=resolveWrite(filepath);return RNFileManager.writeFile(write.style,write.path,contents,options.encoding).then(function(){})}let b64;return options.encoding==="utf8"?b64=Buffer.from(contents,"utf8").toString("base64"):options.encoding==="ascii"?b64=Buffer.from(contents,"ascii").toString("base64"):options.encoding==="base64"&&(b64=contents),RNFSManager.writeFile(normalizeFilePath(filepath),b64,options)},mkdir(filepath){if(!RNFSManager)throw new Error("Function 'mkdir' is unsupported on versions <211.6 (missing RNFS)");return RNFSManager.mkdir(normalizeFilePath(filepath),{}).then(function(){})},MainBundlePath:RNFSManager?.RNFSMainBundlePath,get CachesDirectoryPath(){return RNFSManager?.RNFSCachesDirectoryPath??RNFileManager.getConstants().CacheDirPath},ExternalCachesDirectoryPath:RNFSManager?.RNFSExternalCachesDirectoryPath,get DocumentDirectoryPath(){return RNFSManager?.RNFSDocumentDirectoryPath??RNFileManager.getConstants().DocumentsDirPath},DownloadDirectoryPath:RNFSManager?.RNFSDownloadDirectoryPath,ExternalDirectoryPath:RNFSManager?.RNFSExternalDirectoryPath,ExternalStorageDirectoryPath:RNFSManager?.RNFSExternalStorageDirectoryPath,TemporaryDirectoryPath:RNFSManager?.RNFSTemporaryDirectoryPath,LibraryDirectoryPath:RNFSManager?.RNFSLibraryDirectoryPath,PicturesDirectoryPath:RNFSManager?.RNFSPicturesDirectoryPath,FileProtectionKeys:RNFSManager?.RNFSFileProtectionKeys,RoamingDirectoryPath:RNFSManager?.RNFSRoamingDirectoryPath,hasRNFS:!!RNFSManager};function createJSONStorage(getStorage,options){let storage;try{storage=getStorage()}catch{return}return{getItem:function(name){var _a;const parse=function(str2){return str2===null?null:JSON.parse(str2,void 0)},str=(_a=storage.getItem(name))!=null?_a:null;return str instanceof Promise?str.then(parse):parse(str)},setItem:function(name,newValue){return storage.setItem(name,JSON.stringify(newValue,void 0))},removeItem:function(name){return storage.removeItem(name)}}}const toThenable=function(fn){return function(input){try{const result=fn(input);return result instanceof Promise?result:{then(onFulfilled){return toThenable(onFulfilled)(result)},catch(_onRejected){return this}}}catch(e){return{then(_onFulfilled){return this},catch(onRejected){return toThenable(onRejected)(e)}}}}},oldImpl=function(config,baseOptions){return function(set,get,api){let options={getStorage:function(){return localStorage},serialize:JSON.stringify,deserialize:JSON.parse,partialize:function(state){return state},version:0,merge:function(persistedState,currentState){return{...currentState,...persistedState}},...baseOptions},hasHydrated=!1;const hydrationListeners=new Set,finishHydrationListeners=new Set;let storage;try{storage=options.getStorage()}catch{}if(!storage)return config(function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];console.warn(`[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`),set(...args)},get,api);const thenableSerialize=toThenable(options.serialize),setItem=function(){const state=options.partialize({...get()});let errorInSync;const thenable=thenableSerialize({state,version:options.version}).then(function(serializedValue){return storage.setItem(options.name,serializedValue)}).catch(function(e){errorInSync=e});if(errorInSync)throw errorInSync;return thenable},savedSetState=api.setState;api.setState=function(state,replace){savedSetState(state,replace),setItem()};const configResult=config(function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];set(...args),setItem()},get,api);let stateFromStorage;const hydrate=function(){var _a;if(!storage)return;hasHydrated=!1,hydrationListeners.forEach(function(cb){return cb(get())});const postRehydrationCallback=((_a=options.onRehydrateStorage)==null?void 0:_a.call(options,get()))||void 0;return toThenable(storage.getItem.bind(storage))(options.name).then(function(storageValue){if(storageValue)return options.deserialize(storageValue)}).then(function(deserializedStorageValue){if(deserializedStorageValue)if(typeof deserializedStorageValue.version=="number"&&deserializedStorageValue.version!==options.version){if(options.migrate)return options.migrate(deserializedStorageValue.state,deserializedStorageValue.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return deserializedStorageValue.state}).then(function(migratedState){var _a2;return stateFromStorage=options.merge(migratedState,(_a2=get())!=null?_a2:configResult),set(stateFromStorage,!0),setItem()}).then(function(){postRehydrationCallback?.(stateFromStorage,void 0),hasHydrated=!0,finishHydrationListeners.forEach(function(cb){return cb(stateFromStorage)})}).catch(function(e){postRehydrationCallback?.(void 0,e)})};return api.persist={setOptions:function(newOptions){options={...options,...newOptions},newOptions.getStorage&&(storage=newOptions.getStorage())},clearStorage:function(){storage?.removeItem(options.name)},getOptions:function(){return options},rehydrate:function(){return hydrate()},hasHydrated:function(){return hasHydrated},onHydrate:function(cb){return hydrationListeners.add(cb),function(){hydrationListeners.delete(cb)}},onFinishHydration:function(cb){return finishHydrationListeners.add(cb),function(){finishHydrationListeners.delete(cb)}}},hydrate(),stateFromStorage||configResult}},newImpl=function(config,baseOptions){return function(set,get,api){let options={storage:createJSONStorage(function(){return localStorage}),partialize:function(state){return state},version:0,merge:function(persistedState,currentState){return{...currentState,...persistedState}},...baseOptions},hasHydrated=!1;const hydrationListeners=new Set,finishHydrationListeners=new Set;let storage=options.storage;if(!storage)return config(function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];console.warn(`[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`),set(...args)},get,api);const setItem=function(){const state=options.partialize({...get()});return storage.setItem(options.name,{state,version:options.version})},savedSetState=api.setState;api.setState=function(state,replace){savedSetState(state,replace),setItem()};const configResult=config(function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];set(...args),setItem()},get,api);api.getInitialState=function(){return configResult};let stateFromStorage;const hydrate=function(){var _a,_b;if(!storage)return;hasHydrated=!1,hydrationListeners.forEach(function(cb){var _a2;return cb((_a2=get())!=null?_a2:configResult)});const postRehydrationCallback=((_b=options.onRehydrateStorage)==null?void 0:_b.call(options,(_a=get())!=null?_a:configResult))||void 0;return toThenable(storage.getItem.bind(storage))(options.name).then(function(deserializedStorageValue){if(deserializedStorageValue)if(typeof deserializedStorageValue.version=="number"&&deserializedStorageValue.version!==options.version){if(options.migrate)return options.migrate(deserializedStorageValue.state,deserializedStorageValue.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return deserializedStorageValue.state}).then(function(migratedState){var _a2;return stateFromStorage=options.merge(migratedState,(_a2=get())!=null?_a2:configResult),set(stateFromStorage,!0),setItem()}).then(function(){postRehydrationCallback?.(stateFromStorage,void 0),stateFromStorage=get(),hasHydrated=!0,finishHydrationListeners.forEach(function(cb){return cb(stateFromStorage)})}).catch(function(e){postRehydrationCallback?.(void 0,e)})};return api.persist={setOptions:function(newOptions){options={...options,...newOptions},newOptions.storage&&(storage=newOptions.storage)},clearStorage:function(){storage?.removeItem(options.name)},getOptions:function(){return options},rehydrate:function(){return hydrate()},hasHydrated:function(){return hasHydrated},onHydrate:function(cb){return hydrationListeners.add(cb),function(){hydrationListeners.delete(cb)}},onFinishHydration:function(cb){return finishHydrationListeners.add(cb),function(){finishHydrationListeners.delete(cb)}}},options.skipHydration||hydrate(),stateFromStorage||configResult}},persist=function(config,baseOptions){return"getStorage"in baseOptions||"serialize"in baseOptions||"deserialize"in baseOptions?(console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),oldImpl(config,baseOptions)):newImpl(config,baseOptions)};var constants$1={github:{url:"https://github.com/nexpid/BunnyPlugins/",raw:"https://raw.githubusercontent.com/nexpid/BunnyPlugins/main/"}};const useLangStore=zustand.create(persist(function(set,get){return{values:{},lastModified:null,update:async function(plugin2){const res=await fetch(`${constants$1.github.raw}lang/values/${plugin2}.json`,{headers:{"if-modified-since":get().lastModified}});if(!res.ok)return;const values=await res.json();set({lastModified:res.headers.get("last-modified"),values})}}},{name:"nexpid-lang",storage:createJSONStorage(function(){return RNMMKVManager}),partialize:function(state){return{values:state.values,lastModified:state.lastModified}},onRehydrateStorage:function(){return function(){return RNMMKVManager.removeItem("nexpid-lang")}}}));var define_DEFAULT_LANG_default2={"plugin.name":"Plugin Browser","sheet.sort.title":"Sorting","sheet.sort.date_newest":"Creation date (new to old)","sheet.sort.date_oldest":"Creation date (old to new)","sheet.sort.name_az":"Name (A to Z)","sheet.sort.name_za":"Name (Z to A)","sheet.plugin.install":"Install plugin","sheet.plugin.uninstall":"Uninstall plugin","sheet.plugin.copy_plugin_link":"Copy plugin link","sheet.plugin.open_github":"Open plugin in GitHub","sheet.plugin.copy_unproxied_link":"Copy unproxied plugin link","browser.plugin.new":"new","toast.copy_link":"Copied link!","toast.open_link":"Opening link...","toast.plugin.update.success":"Updated {plugin}!","toast.plugin.update.fail":"Failed to update {plugin}!","toast.plugin.delete.success":"Deleted {plugin}!","toast.plugin.delete.fail":"Failed to delete {plugin}!","toast.plugin.install.success":"Installed {plugin}!","toast.plugin.install.fail":"Failed to install {plugin}!","toast.data.fail_fetch":"Failed to fetch plugins!","toast.data.fail_parse":"Failed to parse plugins!"};function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const IntlMessageFormat=metro.findByName("MessageFormat");RNFS.exists(`${RNFS.DocumentDirectoryPath}/vendetta/NexpidLang`).then(function(yes){return yes&&RNFS.unlink(`${RNFS.DocumentDirectoryPath}/vendetta/NexpidLang`)});let Lang=function(){function Lang2(plugin2){var _this=this;_class_call_check(this,Lang2),_define_property(this,"plugin",void 0),_define_property(this,"_unload",void 0),_define_property(this,"Values",void 0),this.plugin=plugin2,useLangStore.persist.setOptions({name:`nexpid-lang-${plugin2}`,onRehydrateStorage:function(){return function(state){return state.update(_this.plugin)}}}),useLangStore.persist.rehydrate(),this._unload=fluxSubscribe("I18N_LOAD_SUCCESS",function(){return useLangStore.persist.rehydrate()})}return _create_class(Lang2,[{key:"unload",value:function(){var _this__unload,_this;(_this__unload=(_this=this)._unload)===null||_this__unload===void 0||_this__unload.call(_this)}},{key:"format",value:function(_key,input){var _values_locale,_values_en,_DEFAULT_LANG;const key=_key,locale=Lang2.getLang(),values=useLangStore.getState().values;if(!values)return String(key);const val=((_values_locale=values[locale])===null||_values_locale===void 0?void 0:_values_locale[key])??((_values_en=values.en)===null||_values_en===void 0?void 0:_values_en[key])??((_DEFAULT_LANG=define_DEFAULT_LANG_default2)===null||_DEFAULT_LANG===void 0?void 0:_DEFAULT_LANG[key]);return val?Object.keys(input).length>0?new IntlMessageFormat(val).format(input):val:String(key)}}],[{key:"getLang",value:function(){var _i18n_getLocale;const lang2=((_i18n_getLocale=common.i18n.getLocale())===null||_i18n_getLocale===void 0?void 0:_i18n_getLocale.replace(/-/g,"_"))??"en";return lang2.startsWith("en_")?"en":lang2}},{key:"basicFormat",value:function(text){const rules=[{regex:/\*\*(.*?)\*\*/g,react:function(txt2){return React.createElement(common.ReactNative.Text,{style:{fontWeight:"900"}},txt2)}}],txt=text.split("");let off=0;for(const rule of rules){const matches=Array.from(text.matchAll(rule.regex));for(const match of matches)match[1]&&(txt.splice(match.index-off,match[0].length,rule.react(match[1])),off+=match[0].length-1)}return txt}}]),Lang2}();const{Text:_Text}=components.General;function Text(param){let{variant,lineClamp,color,align,style,onPress,getChildren,children,liveUpdate}=param;const[_,forceUpdate]=common.React.useReducer(function(x){return~x},0);return common.React.useEffect(function(){if(!liveUpdate)return;const nextSecond=new Date().setMilliseconds(1e3);let interval;const timeout=setTimeout(function(){forceUpdate(),interval=setInterval(forceUpdate,1e3)},nextSecond-Date.now());return function(){clearTimeout(timeout),clearInterval(interval)}},[]),common.React.createElement(_Text,{style:[variant?TextStyleSheet[variant]:{},color?{color:resolveSemanticColor(ui.semanticColors[color])}:{},align?{textAlign:align}:{},style??{}],numberOfLines:lineClamp,onPress},getChildren?.()??children)}function TextBadge(param){let{style,variant,children,shiny}=param;const[width,setWidth]=common.React.useState(0),styles2=common.stylesheet.createThemedStyleSheet({main:{flexDirection:"row",alignItems:"center",justifyContent:"center",borderRadius:2147483647,paddingHorizontal:6,paddingVertical:3,backgroundColor:ui.semanticColors[`REDESIGN_BUTTON_${variant.toUpperCase()}_BACKGROUND`],color:ui.semanticColors[`REDESIGN_BUTTON_${variant.toUpperCase()}_TEXT`],marginTop:3,overflow:"hidden"},shiner:{position:"absolute",width:7,height:80,backgroundColor:"#fff4"}}),shinyTranslate=Reanimated.useSharedValue(0),randomness=common.React.useRef(1500+Math.floor(Math.random()*696)).current;return common.React.useEffect(function(){width!==0&&shiny?shinyTranslate.value=Reanimated.withRepeat(Reanimated.withSequence(Reanimated.withTiming(-width,{duration:0}),Reanimated.withDelay(randomness,Reanimated.withTiming(width,{duration:800,easing:Reanimated.Easing.inOut(Reanimated.Easing.cubic)}))),0):shinyTranslate.value=500},[shiny,width]),common.React.createElement(common.ReactNative.View,{style:[styles2.main,style],onLayout:function(layout){return setWidth(layout.nativeEvent.layout.width*.5+4)}},shiny&&width!==0&&common.React.createElement(Reanimated.default.View,{style:[styles2.shiner,{transform:[{rotate:"-22deg"},{translateX:shinyTranslate}]}]}),common.React.createElement(Text,{variant:"text-xxs/bold",color:"STATUS_DANGER_TEXT",align:"center",style:{textTransform:"uppercase"}},children))}function managePage(options,navigation){for(var _len=arguments.length,deps=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++)deps[_key-2]=arguments[_key];navigation||(navigation=common.NavigationNative.useNavigation()),common.React.useEffect(function(){navigation.setOptions(options)},[navigation,...deps])}const{FormSection}=components.Forms,getScreens=metro.findByName("getScreens"),settingsModule=metro.findByName("UserSettingsOverviewWrapper",!1),styles$1=common.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:ui.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function patchSettingsPin(shouldAppear,render,you){const patches=[],unpatch2=patcher$1.after("default",settingsModule,function(_,ret){unpatch2();const Overview=utils.findInReactTree(ret.props.children,function(i){return i.type&&i.type.name==="UserSettingsOverview"});patches.push(patcher$1.after("render",Overview.type.prototype,function(_2,param){let{props:{children}}=param;const titles=[common.i18n.Messages.BILLING_SETTINGS,common.i18n.Messages.PREMIUM_SETTINGS];children=utils.findInReactTree(children,function(t){return t.children[1].type===FormSection}).children;const index2=children.findIndex(function(c){return titles.includes(c?.props.label)});shouldAppear()&&children.splice(index2===-1?4:index2,0,render({}))}))},!0);if(patches.push(unpatch2),getScreens&&you){const screenKey=`BUNNY_PLUGIN_${common.lodash.snakeCase(you.key).toUpperCase()}`,Page=you.page.render,component=common.React.memo(function(param){let{navigation}=param;return managePage(utils.without({...you.page,title:you.title()},"noErrorBoundary","render"),navigation),common.React.createElement(common.ReactNative.View,{style:styles$1.container},you.page.noErrorBoundary?common.React.createElement(Page,null):common.React.createElement(components.ErrorBoundary,null,common.React.createElement(Page,null)))});let predicateReq=!0;patches.push(function(){return predicateReq=!1});const rendererConfig={[screenKey]:{type:"route",title:function(){return you.title()},usePredicate:function(){return predicateReq&&(shouldAppear?shouldAppear():!0)},useTrailing:you.trailing,icon:you.icon,parent:null,screen:{route:`BunnyPlugin${common.lodash.chain(you.key).camelCase().upperFirst().value()}`,getComponent:function(){return component}}}},manipulateSections=function(ret,nw){var _cloned_,_section_settings;const cloned=[...ret],sections=nw?cloned==null||(_cloned_=cloned[0])===null||_cloned_===void 0?void 0:_cloned_.sections:cloned;if(!Array.isArray(sections))return sections;const title="Bunny",section=sections.find(function(x){return x?.title===title||x?.label===title});return section&&!(!(section==null||(_section_settings=section.settings)===null||_section_settings===void 0)&&_section_settings.includes(screenKey))&&section.settings.push(screenKey),cloned},oldYouPatch=function(){const layout=metro.findByProps("useOverviewSettings"),titleConfig=metro.findByProps("getSettingTitleConfig"),stuff=metro.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),OLD_getterFunction="getSettingSearchListItems",NEW_getterFunction="getSettingListItems",oldGettersModule=metro.findByProps(OLD_getterFunction),getterFunctionName=oldGettersModule?OLD_getterFunction:NEW_getterFunction,getters=oldGettersModule??metro.findByProps(NEW_getterFunction);if(!getters||!layout)return!1;patches.push(patcher$1.after("useOverviewSettings",layout,function(_,ret){return manipulateSections(ret)})),patches.push(patcher$1.after("getSettingTitleConfig",titleConfig,function(_,ret){return{...ret,[screenKey]:you.title}})),patches.push(patcher$1.after(getterFunctionName,getters,function(param,ret){let[settings]=param;return[...settings.includes(screenKey)?[{type:"setting_search_result",ancestorRendererData:rendererConfig[screenKey],setting:screenKey,title:function(){return you.title},breadcrumbs:["Bunny","Nexpid"],icon:rendererConfig[screenKey].icon}]:[],...ret]}));const oldRelationships=stuff.SETTING_RELATIONSHIPS,oldRendererConfigs=stuff.SETTING_RENDERER_CONFIGS;return stuff.SETTING_RELATIONSHIPS={...oldRelationships,[screenKey]:null},stuff.SETTING_RENDERER_CONFIGS={...oldRendererConfigs,...rendererConfig},patches.push(function(){stuff.SETTING_RELATIONSHIPS=oldRelationships,stuff.SETTING_RENDERER_CONFIGS=oldRelationships}),!0};(function(){const settingsListComponents=metro.findByProps("SearchableSettingsList"),settingConstantsModule=metro.findByProps("SETTING_RENDERER_CONFIG"),gettersModule=metro.findByProps("getSettingListItems");if(!gettersModule||!settingsListComponents||!settingConstantsModule)return!1;patches.push(patcher$1.before("type",settingsListComponents.SearchableSettingsList,function(ret){return manipulateSections(ret,!0)})),patches.push(patcher$1.after("getSettingListSearchResultItems",gettersModule,function(_,ret){for(const s of ret)s.setting===screenKey&&(s.breadcrumbs=["Bunny","Nexpid"])}));const oldRendererConfig=settingConstantsModule.SETTING_RENDERER_CONFIG;return settingConstantsModule.SETTING_RENDERER_CONFIG={...oldRendererConfig,...rendererConfig},patches.push(function(){settingConstantsModule.SETTING_RENDERER_CONFIG=oldRendererConfig}),!0})()||oldYouPatch()}return function(){return patches.forEach(function(x){return x()})}}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var fuzzysort$1={exports:{}};(function(module){(function(root,UMD){module.exports?module.exports=UMD():root.fuzzysort=UMD()})(commonjsGlobal,function(_){var single=function(search,target){if(search=="farzher")return{target:"farzher was here (^-^*)/",score:0,_indexes:[0]};if(!search||!target)return NULL;var preparedSearch=getPreparedSearch(search);isObj(target)||(target=getPrepared(target));var searchBitflags=preparedSearch.bitflags;return(searchBitflags&target._bitflags)!==searchBitflags?NULL:algorithm(preparedSearch,target)},go=function(search,targets,options){if(search=="farzher")return[{target:"farzher was here (^-^*)/",score:0,_indexes:[0],obj:targets?targets[0]:NULL}];if(!search)return options&&options.all?all(search,targets,options):noResults;var preparedSearch=getPreparedSearch(search),searchBitflags=preparedSearch.bitflags;preparedSearch.containsSpace;var threshold=options&&options.threshold||INT_MIN,limit=options&&options.limit||INT_MAX,resultsLen=0,limitedCount=0,targetsLen=targets.length;if(options&&options.key)for(var key=options.key,i=0;i<targetsLen;++i){var obj=targets[i],target=getValue(obj,key);if(target&&(isObj(target)||(target=getPrepared(target)),(searchBitflags&target._bitflags)===searchBitflags)){var result=algorithm(preparedSearch,target);result!==NULL&&(result.score<threshold||(result={target:result.target,_targetLower:"",_targetLowerCodes:NULL,_nextBeginningIndexes:NULL,_bitflags:0,score:result.score,_indexes:result._indexes,obj},resultsLen<limit?(q.add(result),++resultsLen):(++limitedCount,result.score>q.peek().score&&q.replaceTop(result))))}}else if(options&&options.keys)for(var scoreFn=options.scoreFn||defaultScoreFn,keys=options.keys,keysLen=keys.length,i=0;i<targetsLen;++i){for(var obj=targets[i],objResults=new Array(keysLen),keyI=0;keyI<keysLen;++keyI){var key=keys[keyI],target=getValue(obj,key);if(!target){objResults[keyI]=NULL;continue}isObj(target)||(target=getPrepared(target)),(searchBitflags&target._bitflags)!==searchBitflags?objResults[keyI]=NULL:objResults[keyI]=algorithm(preparedSearch,target)}objResults.obj=obj;var score=scoreFn(objResults);score!==NULL&&(score<threshold||(objResults.score=score,resultsLen<limit?(q.add(objResults),++resultsLen):(++limitedCount,score>q.peek().score&&q.replaceTop(objResults))))}else for(var i=0;i<targetsLen;++i){var target=targets[i];if(target&&(isObj(target)||(target=getPrepared(target)),(searchBitflags&target._bitflags)===searchBitflags)){var result=algorithm(preparedSearch,target);result!==NULL&&(result.score<threshold||(resultsLen<limit?(q.add(result),++resultsLen):(++limitedCount,result.score>q.peek().score&&q.replaceTop(result))))}}if(resultsLen===0)return noResults;for(var results=new Array(resultsLen),i=resultsLen-1;i>=0;--i)results[i]=q.poll();return results.total=resultsLen+limitedCount,results},highlight=function(result,hOpen,hClose){if(typeof hOpen=="function")return highlightCallback(result,hOpen);if(result===NULL)return NULL;hOpen===void 0&&(hOpen="<b>"),hClose===void 0&&(hClose="</b>");var highlighted="",matchesIndex=0,opened=!1,target=result.target,targetLen=target.length,indexes2=result._indexes;indexes2=indexes2.slice(0,indexes2.len).sort(function(a,b){return a-b});for(var i=0;i<targetLen;++i){var char=target[i];if(indexes2[matchesIndex]===i){if(++matchesIndex,opened||(opened=!0,highlighted+=hOpen),matchesIndex===indexes2.length){highlighted+=char+hClose+target.substr(i+1);break}}else opened&&(opened=!1,highlighted+=hClose);highlighted+=char}return highlighted},highlightCallback=function(result,cb){if(result===NULL)return NULL;var target=result.target,targetLen=target.length,indexes2=result._indexes;indexes2=indexes2.slice(0,indexes2.len).sort(function(a,b){return a-b});for(var highlighted="",matchI=0,indexesI=0,opened=!1,result=[],i=0;i<targetLen;++i){var char=target[i];if(indexes2[indexesI]===i){if(++indexesI,opened||(opened=!0,result.push(highlighted),highlighted=""),indexesI===indexes2.length){highlighted+=char,result.push(cb(highlighted,matchI++)),highlighted="",result.push(target.substr(i+1));break}}else opened&&(opened=!1,result.push(cb(highlighted,matchI++)),highlighted="");highlighted+=char}return result},indexes=function(result){return result._indexes.slice(0,result._indexes.len).sort(function(a,b){return a-b})},prepare=function(target){typeof target!="string"&&(target="");var info=prepareLowerInfo(target);return{target,_targetLower:info._lower,_targetLowerCodes:info.lowerCodes,_nextBeginningIndexes:NULL,_bitflags:info.bitflags,score:NULL,_indexes:[0],obj:NULL}},prepareSearch=function(search){typeof search!="string"&&(search=""),search=search.trim();var info=prepareLowerInfo(search),spaceSearches=[];if(info.containsSpace){var searches=search.split(/\s+/);searches=[...new Set(searches)];for(var i=0;i<searches.length;i++)if(searches[i]!==""){var _info=prepareLowerInfo(searches[i]);spaceSearches.push({lowerCodes:_info.lowerCodes,_lower:searches[i].toLowerCase(),containsSpace:!1})}}return{lowerCodes:info.lowerCodes,bitflags:info.bitflags,containsSpace:info.containsSpace,_lower:info._lower,spaceSearches}},getPrepared=function(target){if(target.length>999)return prepare(target);var targetPrepared=preparedCache.get(target);return targetPrepared!==void 0||(targetPrepared=prepare(target),preparedCache.set(target,targetPrepared)),targetPrepared},getPreparedSearch=function(search){if(search.length>999)return prepareSearch(search);var searchPrepared=preparedSearchCache.get(search);return searchPrepared!==void 0||(searchPrepared=prepareSearch(search),preparedSearchCache.set(search,searchPrepared)),searchPrepared},all=function(search,targets,options){var results=[];results.total=targets.length;var limit=options&&options.limit||INT_MAX;if(options&&options.key)for(var i=0;i<targets.length;i++){var obj=targets[i],target=getValue(obj,options.key);if(target){isObj(target)||(target=getPrepared(target)),target.score=INT_MIN,target._indexes.len=0;var result=target;if(result={target:result.target,_targetLower:"",_targetLowerCodes:NULL,_nextBeginningIndexes:NULL,_bitflags:0,score:target.score,_indexes:NULL,obj},results.push(result),results.length>=limit)return results}}else if(options&&options.keys)for(var i=0;i<targets.length;i++){for(var obj=targets[i],objResults=new Array(options.keys.length),keyI=options.keys.length-1;keyI>=0;--keyI){var target=getValue(obj,options.keys[keyI]);if(!target){objResults[keyI]=NULL;continue}isObj(target)||(target=getPrepared(target)),target.score=INT_MIN,target._indexes.len=0,objResults[keyI]=target}if(objResults.obj=obj,objResults.score=INT_MIN,results.push(objResults),results.length>=limit)return results}else for(var i=0;i<targets.length;i++){var target=targets[i];if(target&&(isObj(target)||(target=getPrepared(target)),target.score=INT_MIN,target._indexes.len=0,results.push(target),results.length>=limit))return results}return results},algorithm=function(preparedSearch,prepared){if((arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1)===!1&&preparedSearch.containsSpace)return algorithmSpaces(preparedSearch,prepared);for(var searchLower=preparedSearch._lower,searchLowerCodes=preparedSearch.lowerCodes,searchLowerCode=searchLowerCodes[0],targetLowerCodes=prepared._targetLowerCodes,searchLen=searchLowerCodes.length,targetLen=targetLowerCodes.length,searchI=0,targetI=0,matchesSimpleLen=0;;){var isMatch=searchLowerCode===targetLowerCodes[targetI];if(isMatch){if(matchesSimple[matchesSimpleLen++]=targetI,++searchI,searchI===searchLen)break;searchLowerCode=searchLowerCodes[searchI]}if(++targetI,targetI>=targetLen)return NULL}var searchI=0,successStrict=!1,matchesStrictLen=0,nextBeginningIndexes=prepared._nextBeginningIndexes;nextBeginningIndexes===NULL&&(nextBeginningIndexes=prepared._nextBeginningIndexes=prepareNextBeginningIndexes(prepared.target)),targetI=matchesSimple[0]===0?0:nextBeginningIndexes[matchesSimple[0]-1];var backtrackCount=0;if(targetI!==targetLen)for(;;)if(targetI>=targetLen){if(searchI<=0||(++backtrackCount,backtrackCount>200))break;--searchI;var lastMatch=matchesStrict[--matchesStrictLen];targetI=nextBeginningIndexes[lastMatch]}else{var isMatch=searchLowerCodes[searchI]===targetLowerCodes[targetI];if(isMatch){if(matchesStrict[matchesStrictLen++]=targetI,++searchI,searchI===searchLen){successStrict=!0;break}++targetI}else targetI=nextBeginningIndexes[targetI]}var substringIndex=prepared._targetLower.indexOf(searchLower,matchesSimple[0]),isSubstring=~substringIndex;if(isSubstring&&!successStrict)for(var i=0;i<matchesSimpleLen;++i)matchesSimple[i]=substringIndex+i;var isSubstringBeginning=!1;isSubstring&&(isSubstringBeginning=prepared._nextBeginningIndexes[substringIndex-1]===substringIndex);{if(successStrict)var matchesBest=matchesStrict,matchesBestLen=matchesStrictLen;else var matchesBest=matchesSimple,matchesBestLen=matchesSimpleLen;for(var score=0,extraMatchGroupCount=0,i=1;i<searchLen;++i)matchesBest[i]-matchesBest[i-1]!==1&&(score-=matchesBest[i],++extraMatchGroupCount);var unmatchedDistance=matchesBest[searchLen-1]-matchesBest[0]-(searchLen-1);if(score-=(12+unmatchedDistance)*extraMatchGroupCount,matchesBest[0]!==0&&(score-=matchesBest[0]*matchesBest[0]*.2),!successStrict)score*=1e3;else{for(var uniqueBeginningIndexes=1,i=nextBeginningIndexes[0];i<targetLen;i=nextBeginningIndexes[i])++uniqueBeginningIndexes;uniqueBeginningIndexes>24&&(score*=(uniqueBeginningIndexes-24)*10)}isSubstring&&(score/=1+searchLen*searchLen*1),isSubstringBeginning&&(score/=1+searchLen*searchLen*1),score-=targetLen-searchLen,prepared.score=score;for(var i=0;i<matchesBestLen;++i)prepared._indexes[i]=matchesBest[i];return prepared._indexes.len=matchesBestLen,prepared}},algorithmSpaces=function(preparedSearch,target){for(var seen_indexes=new Set,score=0,result=NULL,first_seen_index_last_search=0,searches=preparedSearch.spaceSearches,i=0;i<searches.length;++i){var search=searches[i];if(result=algorithm(search,target),result===NULL)return NULL;score+=result.score,result._indexes[0]<first_seen_index_last_search&&(score-=first_seen_index_last_search-result._indexes[0]),first_seen_index_last_search=result._indexes[0];for(var j=0;j<result._indexes.len;++j)seen_indexes.add(result._indexes[j])}var allowSpacesResult=algorithm(preparedSearch,target,!0);if(allowSpacesResult!==NULL&&allowSpacesResult.score>score)return allowSpacesResult;result.score=score;var i=0;for(let index2 of seen_indexes)result._indexes[i++]=index2;return result._indexes.len=i,result},prepareLowerInfo=function(str){for(var strLen=str.length,lower=str.toLowerCase(),lowerCodes=[],bitflags=0,containsSpace=!1,i=0;i<strLen;++i){var lowerCode=lowerCodes[i]=lower.charCodeAt(i);if(lowerCode===32){containsSpace=!0;continue}var bit=lowerCode>=97&&lowerCode<=122?lowerCode-97:lowerCode>=48&&lowerCode<=57?26:lowerCode<=127?30:31;bitflags|=1<<bit}return{lowerCodes,bitflags,containsSpace,_lower:lower}},prepareBeginningIndexes=function(target){for(var targetLen=target.length,beginningIndexes=[],beginningIndexesLen=0,wasUpper=!1,wasAlphanum=!1,i=0;i<targetLen;++i){var targetCode=target.charCodeAt(i),isUpper=targetCode>=65&&targetCode<=90,isAlphanum=isUpper||targetCode>=97&&targetCode<=122||targetCode>=48&&targetCode<=57,isBeginning=isUpper&&!wasUpper||!wasAlphanum||!isAlphanum;wasUpper=isUpper,wasAlphanum=isAlphanum,isBeginning&&(beginningIndexes[beginningIndexesLen++]=i)}return beginningIndexes},prepareNextBeginningIndexes=function(target){for(var targetLen=target.length,beginningIndexes=prepareBeginningIndexes(target),nextBeginningIndexes=[],lastIsBeginning=beginningIndexes[0],lastIsBeginningI=0,i=0;i<targetLen;++i)lastIsBeginning>i?nextBeginningIndexes[i]=lastIsBeginning:(lastIsBeginning=beginningIndexes[++lastIsBeginningI],nextBeginningIndexes[i]=lastIsBeginning===void 0?targetLen:lastIsBeginning);return nextBeginningIndexes},cleanup=function(){preparedCache.clear(),preparedSearchCache.clear(),matchesSimple=[],matchesStrict=[]},preparedCache=new Map,preparedSearchCache=new Map,matchesSimple=[],matchesStrict=[],defaultScoreFn=function(a){for(var max=INT_MIN,len=a.length,i=0;i<len;++i){var result=a[i];if(result!==NULL){var score=result.score;score>max&&(max=score)}}return max===INT_MIN?NULL:max},getValue=function(obj,prop){var tmp=obj[prop];if(tmp!==void 0)return tmp;var segs=prop;Array.isArray(prop)||(segs=prop.split("."));for(var len=segs.length,i=-1;obj&&++i<len;)obj=obj[segs[i]];return obj},isObj=function(x){return typeof x=="object"},INT_MAX=1/0,INT_MIN=-INT_MAX,noResults=[];noResults.total=0;var NULL=null,fastpriorityqueue=function(r){var e=[],o=0,a={},v=function(r2){for(var a2=0,v2=e[a2],c=1;c<o;){var s=c+1;a2=c,s<o&&e[s].score<e[c].score&&(a2=s),e[a2-1>>1]=e[a2],c=1+(a2<<1)}for(var f=a2-1>>1;a2>0&&v2.score<e[f].score;f=(a2=f)-1>>1)e[a2]=e[f];e[a2]=v2};return a.add=function(r2){var a2=o;e[o++]=r2;for(var v2=a2-1>>1;a2>0&&r2.score<e[v2].score;v2=(a2=v2)-1>>1)e[a2]=e[v2];e[a2]=r2},a.poll=function(r2){if(o!==0){var a2=e[0];return e[0]=e[--o],v(),a2}},a.peek=function(r2){if(o!==0)return e[0]},a.replaceTop=function(r2){e[0]=r2,v()},a},q=fastpriorityqueue();return{single,go,highlight,prepare,indexes,cleanup}})})(fuzzysort$1);var fuzzysortExports=fuzzysort$1.exports,fuzzysort=getDefaultExportFromCjs(fuzzysortExports);const{FormRow:FormRow$2}=components.Forms;function ChooseSheet(param){let{title,value:_value,options,callback}=param;const[value,setValue]=common.React.useState(_value);return common.React.createElement(ActionSheet,null,common.React.createElement(ActionSheetContentContainer,null,common.React.createElement(ActionSheetTitleHeader,{title,trailing:common.React.createElement(ActionSheetCloseButton,{onPress:function(){return hideActionSheet$1()}})}),options.map(function(x){return common.React.createElement(FormRow$2,{label:x.name,subLabel:x.description,trailing:x.iconComponent?x.iconComponent:x.icon&&common.React.createElement(common.ReactNative.Image,{source:x.icon,resizeMode:"cover",style:{width:24,height:24,tintColor:x.iconColor}}),leading:common.React.createElement(FormRow$2.Radio,{selected:x.value===value}),onPress:function(){setValue(x.value),callback(x.value)}})})))}var constants={proxyUrl:"https://bn-plugins.github.io/vd-proxy/",customLinks:{"vendetta.nexpid.xyz":function(path){return`${constants$1.github.url}tree/main/plugins/${path.join("/")}`},"mugman.catvibers.me":function(path){return`https://github.com/mugman174/${path[0]}/tree/master/plugins/${path.slice(1).join("/")}`},"plugins.obamabot.me":function(path){return`https://github.com/WolfPlugs/${path[0]}/tree/master/${path.slice(1).join("/")}`}}};function properLink(id){return id.endsWith("/")?id:id+"/"}const linkMatches={origin:/^([^/]+)\/(.*)/,multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/};function matchGithubLink(link){const multi=link.match(linkMatches.multiplePluginGitio);if(multi?.[0])return`https://github.com/${multi[1]}/${multi[2]}/tree/master/plugins/${multi[3]}`;const single=link.match(linkMatches.singlePluginGitio)??link.match(linkMatches.githubReleases);if(single?.[0])return`https://github.com/${single[1]}/${single[2]}`;const[_,origin,path]=link.match(linkMatches.origin);if(constants.customLinks[origin])return constants.customLinks[origin](path.split("/"))}let lastPluginCache=new Array;function getChanges(){return!lastPluginCache[0]||!vstorage.pluginCache[0]?[]:lastPluginCache.filter(function(id){return!vstorage.pluginCache.includes(id)})}function updateChanges(){vstorage.pluginCache=lastPluginCache}async function run(data){lastPluginCache=(data??await(await utils.safeFetch(`${constants.proxyUrl}plugins.json`,{cache:"no-store"})).json()).map(function(x){return properLink(typeof x=="string"?x:x.vendetta.original)})}function initThing(){const interval=setInterval(run,36e5);return run(),function(){return clearInterval(interval)}}const OhFuck=function(prop){return function(){return common.React.useEffect(function(){toasts.showToast("Uh oh, something broke! Search for fckp in Debug Logs!"),console.warn(`Uh oh (fckp)!!
Missing the redesign component: ${prop}. Please bug @nexpid about this on Discord!`)},[]),null}},OhFuckFunction=function(prop){return function(){return toasts.showToast("Uh oh, something broke! Search for fckp in Debug Logs!"),console.warn(`Uh oh (fckp)!!
Missing the redesign function: ${prop}. Please bug @nexpid about this on Discord!`),null}},findThing=function(){for(var _len=arguments.length,props=new Array(_len),_key=0;_key<_len;_key++)props[_key]=arguments[_key];var _findByProps5;return(_findByProps5=metro.findByProps(...props))===null||_findByProps5===void 0?void 0:_findByProps5[props[0]]},findThingRequired=function(alt){for(var _len=arguments.length,props=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)props[_key-1]=arguments[_key];return findThing(...props)??alt(props[0])};function buttonVariantPolyfill(){return"REDESIGN_BUTTON_ACTIVE_TEXT"in ui.semanticColors?{active:"active",destructive:"destructive"}:{active:"positive",destructive:"danger"}}findThingRequired(OhFuck,"Button"),findThingRequired(OhFuck,"RowButton"),findThing("Slider"),findThingRequired(OhFuck,"FloatingActionButton");const TextInput=findThingRequired(OhFuck,"TextInput");findThingRequired(OhFuck,"Tabs"),findThingRequired(OhFuck,"SegmentedControlPages"),findThingRequired(OhFuckFunction,"useSegmentedControlState");var _findByProps;const{hideActionSheet}=metro.findByProps("openLazy","hideActionSheet"),{showSimpleActionSheet}=metro.findByProps("showSimpleActionSheet"),IconButton$1=metro.findByProps("IconButton").IconButton,{FormRow:FormRow$1}=components.Forms,Stack=(_findByProps=metro.findByProps("Stack"))===null||_findByProps===void 0?void 0:_findByProps.Stack,styles=common.stylesheet.createThemedStyleSheet({card:{padding:16,borderRadius:16,borderColor:ui.semanticColors.BORDER_FAINT,borderWidth:1,backgroundColor:ui.semanticColors.CARD_PRIMARY_BG},content:{flexDirection:"row",alignItems:"center"},title:{flexDirection:"row",alignItems:"center",gap:6},pluginIcon:{tintColor:ui.semanticColors.TEXT_NORMAL,width:18,height:18},actions:{flexDirection:"row-reverse",alignItems:"center",gap:5}});function Card(props){var _props_actions;const baseColor=styles.card.backgroundColor,highlightColor=lerp(baseColor,ui.rawColors.BRAND_500,.08),color=Reanimated.useSharedValue(baseColor);return common.React.useEffect(function(){color.value=baseColor,props.highlight&&(color.value=Reanimated.withSequence(Reanimated.withTiming(highlightColor,{duration:500,easing:Reanimated.Easing.cubic}),Reanimated.withTiming(baseColor,{duration:500,easing:Reanimated.Easing.cubic})))},[props.highlight]),common.React.createElement(Reanimated.default.View,{style:[styles.card,{backgroundColor:color},props.disabled&&{opacity:.5}]},common.React.createElement(Stack,{spacing:16},common.React.createElement(common.ReactNative.View,{style:styles.content},common.React.createElement(Stack,{spacing:0},common.React.createElement(common.ReactNative.View,{style:styles.title},props.headerIcon&&common.React.createElement(common.ReactNative.Image,{style:styles.pluginIcon,resizeMode:"cover",source:assets.getAssetIDByName(props.headerIcon)}),common.React.createElement(Text,{variant:"heading-md/semibold",color:"TEXT_NORMAL",lineClamp:1},props.headerLabel),props.headerSuffix),props.headerSublabel&&common.React.createElement(Text,{variant:"text-md/semibold",color:"TEXT_MUTED"},props.headerSublabel)),common.React.createElement(common.ReactNative.View,{style:{marginLeft:"auto"}},common.React.createElement(Stack,{spacing:12,direction:"horizontal"},(_props_actions=props.actions)===null||_props_actions===void 0?void 0:_props_actions.map(function(param){let{icon,onPress,isDestructive,loading,disabled}=param;return common.React.createElement(IconButton$1,{onPress,disabled,destructive:isDestructive,loading,size:"sm",variant:isDestructive?buttonVariantPolyfill().destructive:"secondary",icon:assets.getAssetIDByName(icon)})}),props.overflowActions&&common.React.createElement(IconButton$1,{onPress:function(){var _props_overflowActions;return showSimpleActionSheet({key:"CardOverflow",header:{title:props.overflowTitle,icon:props.headerIcon&&common.React.createElement(FormRow$1.Icon,{style:{marginRight:8},source:assets.getAssetIDByName(props.headerIcon)}),onClose:function(){return hideActionSheet()}},options:(_props_overflowActions=props.overflowActions)===null||_props_overflowActions===void 0?void 0:_props_overflowActions.map(function(i){return{...i,icon:assets.getAssetIDByName(i.icon)}})})},size:"sm",variant:"secondary",icon:assets.getAssetIDByName("CircleInformationIcon-primary")})))),props.descriptionLabel&&common.React.createElement(Text,{variant:"text-md/normal",color:"TEXT_NORMAL"},props.descriptionLabel)))}function PluginCard(param){let{item,changes}=param;var _item_bunny,_item_authors,_item_vendetta;const proxiedLink=properLink(`${constants.proxyUrl}${item.vendetta.original}`),githubLink=matchGithubLink(item.vendetta.original),isNew=common.React.useMemo(function(){return changes.includes(properLink(item.vendetta.original))},[changes]),isDisabled=!!(!((_item_bunny=item.bunny)===null||_item_bunny===void 0)&&_item_bunny.disabled),[status,setStatus]=common.React.useState({hasPlugin:!!plugins.plugins[proxiedLink],pending:!1}),installFunction=async function(){if(status.pending||isDisabled)return;setStatus({hasPlugin:!!plugins.plugins[proxiedLink],pending:!0});const shouldRemove=!!plugins.plugins[proxiedLink];try{shouldRemove?plugins.removePlugin(proxiedLink):await plugins.installPlugin(proxiedLink)}catch{toasts.showToast(lang.format(shouldRemove?"toast.plugin.delete.fail":"toast.plugin.install.fail",{plugin:item.name}),assets.getAssetIDByName("Small"))}toasts.showToast(lang.format(shouldRemove?"toast.plugin.delete.success":"toast.plugin.install.success",{plugin:item.name}),assets.getAssetIDByName(shouldRemove?"TrashIcon":"DownloadIcon")),setStatus({hasPlugin:!!plugins.plugins[proxiedLink],pending:!1})};return common.React.createElement(Card,{headerLabel:item.name,headerSuffix:isNew&&common.React.createElement(TextBadge,{variant:"primary",style:{marginLeft:4},shiny:!0},lang.format("browser.plugin.new",{})),highlight:!!isNew,headerSublabel:((_item_authors=item.authors)===null||_item_authors===void 0?void 0:_item_authors[0])&&`by ${item.authors.map(function(x){return x.name}).join(", ")}`,headerIcon:(_item_vendetta=item.vendetta)===null||_item_vendetta===void 0?void 0:_item_vendetta.icon,descriptionLabel:item.description,overflowTitle:item.name,actions:isDisabled?[]:[{icon:status.hasPlugin?"TrashIcon":"DownloadIcon",disabled:status.pending,loading:status.pending,isDestructive:status.hasPlugin,onPress:installFunction}],overflowActions:[...isDisabled?[]:[{label:lang.format(`sheet.plugin.${status.hasPlugin?"un":""}install`,{}),icon:status.hasPlugin?"TrashIcon":"DownloadIcon",isDestructive:status.hasPlugin,onPress:installFunction}],{label:lang.format("sheet.plugin.copy_plugin_link",{}),icon:"CopyIcon",onPress:function(){toasts.showToast(lang.format("toast.copy_link",{}),assets.getAssetIDByName("CopyIcon")),common.clipboard.setString(proxiedLink)}},...githubLink?[{label:lang.format("sheet.plugin.open_github",{}),icon:"img_account_sync_github_white",onPress:async function(){if(toasts.showToast(lang.format("toast.open_link",{}),assets.getAssetIDByName("LinkExternalSmallIcon")),await common.ReactNative.Linking.canOpenURL("https://github.com")){const url2=(await fetch(githubLink,{redirect:"follow"})).url;common.ReactNative.Linking.openURL(url2)}else common.url.openURL(githubLink)}}]:[],{label:lang.format("sheet.plugin.copy_unproxied_link",{}),icon:"CopyIcon",onPress:function(){toasts.showToast(lang.format("toast.copy_link",{}),assets.getAssetIDByName("CopyIcon")),common.clipboard.setString("https://"+item.vendetta.original)}}],disabled:isDisabled})}function SearchIcon(){return common.React.createElement(common.ReactNative.Image,{style:{width:16,height:16,tintColor:resolveSemanticColor(ui.semanticColors.INTERACTIVE_NORMAL)},source:assets.getAssetIDByName("search")})}const IconButton=metro.findByProps("IconButton").IconButton;function Search(param){let{onChangeText,onPressFilters}=param;const[query,setQuery]=common.React.useState(""),onChange=function(value){setQuery(value),onChangeText?.(value)};return common.React.createElement(components.ErrorBoundary,null,common.React.createElement(common.ReactNative.View,{style:{flexDirection:"row",justifyContent:"center",gap:8,marginBottom:5}},common.React.createElement(common.ReactNative.View,{style:{flexGrow:1}},common.React.createElement(TextInput,{grow:!0,isClearable:!0,leadingIcon:SearchIcon,placeholder:common.i18n.Messages.SEARCH,onChange,returnKeyType:"search",size:"md",autoCapitalize:"none",autoCorrect:!1,value:query,isRound:!0})),common.React.createElement(IconButton,{onPress:onPressFilters,icon:assets.getAssetIDByName("FiltersHorizontalIcon"),size:"md",variant:"secondary"})))}var Sort;(function(Sort2){Sort2.DateNewest="sheet.sort.date_newest",Sort2.DateOldest="sheet.sort.date_oldest",Sort2.NameAZ="sheet.sort.name_az",Sort2.NameZA="sheet.sort.name_za"})(Sort||(Sort={}));function PluginBrowserPage(){const[parsed,setParsed]=common.React.useState(null),[search,setSearch]=common.React.useState(""),[sort,setSort]=common.React.useState("sheet.sort.date_newest"),currentSetSort=common.React.useRef(setSort);currentSetSort.current=setSort;const changes=common.React.useRef(getChanges()),sortedData=common.React.useMemo(function(){if(!parsed)return[];let dt=search?fuzzysort.go(search,parsed,{keys:["vendetta.original","name","description","authors.0.name","authors.1.name","authors.2.name"]}).map(function(x){return x.obj}):parsed.slice();return["sheet.sort.name_az","sheet.sort.name_za"].includes(sort)&&(dt=dt.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0})),["sheet.sort.name_za","sheet.sort.date_newest"].includes(sort)&&dt.reverse(),dt},[sort,parsed,search]);return common.React.useEffect(function(){return function(){return updateChanges()}},[]),common.React.useEffect(function(){parsed||utils.safeFetch(`${constants.proxyUrl}plugins-full.json`,{cache:"no-store"}).then(function(x){return x.json().then(function(x2){return x2.map(function(plug){return{...plug,vendetta:{...plug.vendetta,original:properLink(plug.vendetta.original)}}})}).then(function(x2){run(x2),changes.current=getChanges(),setParsed(x2)}).catch(function(){return toasts.showToast(lang.format("toast.data.fail_parse",{}),assets.getAssetIDByName("Small"))})}).catch(function(){return toasts.showToast(lang.format("toast.data.fail_fetch",{}),assets.getAssetIDByName("Small"))})},[parsed]),managePage({title:lang.format("plugin.name",{})}),common.React.createElement(FlashList,{ListHeaderComponent:common.React.createElement(Search,{onChangeText:setSearch,onPressFilters:function(){return openSheet(ChooseSheet,{title:lang.format("sheet.sort.title",{}),value:sort,options:Object.values(Sort).map(function(value){return{name:lang.format(value,{}),value}}),callback:function(val){return currentSetSort.current(val)}})}}),ListFooterComponent:common.React.createElement(common.ReactNative.View,{style:{height:20}}),ItemSeparatorComponent:function(){return common.React.createElement(common.ReactNative.View,{style:{height:15}})},contentContainerStyle:{paddingHorizontal:10},data:sortedData,estimatedItemSize:111,renderItem:function(param){let{item}=param;return common.React.createElement(PluginCard,{item,changes:changes.current})},removeClippedSubviews:!0,refreshControl:common.React.createElement(common.ReactNative.RefreshControl,{refreshing:parsed===null,onRefresh:function(){return parsed!==null&&setParsed(null)}})})}const{FormRow}=components.Forms;function SettingsSection(param){let{changes}=param;const navigation=common.NavigationNative.useNavigation();return React.createElement(components.ErrorBoundary,null,React.createElement(FormRow,{label:React.createElement(React.Fragment,null,React.createElement(Text,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},lang.format("plugin.name",{})),changes&&React.createElement(TextBadge,{variant:"danger"},changes)),leading:React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_search_items_24px")}),trailing:FormRow.Arrow,onPress:function(){return navigation.push("VendettaCustomPage",{render:PluginBrowserPage})}}))}function patcher(){const patches=[];return patches.push(patchSettingsPin(function(){return!0},function(){return common.React.createElement(SettingsSection,{changes:Object.keys(getChanges()).length})},{key:_vendetta.plugin.manifest.name,icon:assets.getAssetIDByName(plugin.manifest.vendetta.icon),trailing:function(){const changes=common.React.useRef(Object.keys(getChanges()).length).current;if(changes>0)return common.React.createElement(TextBadge,{variant:"danger"},changes)},title:function(){return lang.format("plugin.name",{})},page:{render:PluginBrowserPage}})),patches.push(initThing()),patches.push(lang.unload),function(){return patches.forEach(function(x){return x()})}}const vstorage=plugin.storage,lang=new Lang("plugin_browser");let unpatch;var index={onLoad:function(){vstorage.pluginCache??(vstorage.pluginCache=[]),unpatch=patcher()},onUnload:function(){return unpatch?.()}};return exports.default=index,exports.lang=lang,exports.vstorage=vstorage,Object.defineProperty(exports,"__esModule",{value:!0}),exports})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui,vendetta.ui.components,vendetta.patcher,vendetta.utils,vendetta.plugins);
