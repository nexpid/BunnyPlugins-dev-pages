(function(exports,plugin,storage,constants$1,metro,common,ui,alerts,assets,components,toasts,_vendetta,patcher$1){"use strict";var _findByProps,_findByProps1,_findByProps2,_findByProps3,_findByProps4;const ThemeStore=metro.findByStoreName("ThemeStore");metro.findByProps("triggerHaptic");const colorModule=metro.findByProps("colors","unsafe_rawColors"),colorResolver=colorModule?.internal??colorModule?.meta,TextStyleSheet=metro.findByProps("TextStyleSheet").TextStyleSheet,ActionSheet=((_findByProps=metro.findByProps("ActionSheet"))===null||_findByProps===void 0?void 0:_findByProps.ActionSheet)??metro.find(function(x){var _x_render;return((_x_render=x.render)===null||_x_render===void 0?void 0:_x_render.name)==="ActionSheet"}),LazyActionSheet=metro.findByProps("openLazy","hideActionSheet"),{openLazy,hideActionSheet}=LazyActionSheet,{ActionSheetTitleHeader,ActionSheetCloseButton,ActionSheetContentContainer}=metro.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");(_findByProps1=metro.findByProps("ActionSheetRow"))===null||_findByProps1===void 0||_findByProps1.ActionSheetRow,metro.findByName("Navigator")??((_findByProps2=metro.findByProps("Navigator"))===null||_findByProps2===void 0||_findByProps2.Navigator),((_findByProps3=metro.findByProps("getRenderCloseButton"))===null||_findByProps3===void 0?void 0:_findByProps3.getRenderCloseButton)??((_findByProps4=metro.findByProps("getHeaderCloseButton"))===null||_findByProps4===void 0||_findByProps4.getHeaderCloseButton),metro.findByProps("popModal","pushModal");const resolveCustomSemantic=function(dark,light){return ThemeStore.theme!=="light"?dark:light},lerp=function(og,target,perc){const hex2rgb=function(hex){var _hex_match;return((_hex_match=hex.match(/\w\w/g))===null||_hex_match===void 0?void 0:_hex_match.map(function(x){return parseInt(x,16)}))??[0,0,0]},rgb2hex=function(rgb){return`#${rgb.map(function(x){return x.toString(16).padStart(2,"0")}).join("")}`},ogR=hex2rgb(og),targetR=hex2rgb(target),result=ogR.map(function(ogC,i){return Math.round(ogC+(targetR[i]-ogC)*perc)});return rgb2hex(result)};function resolveSemanticColor(color){let theme=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ThemeStore.theme;return colorResolver.resolveSemanticColor(theme,color)}function openSheet(sheet,props){try{openLazy(new Promise(function(x){return x({default:sheet})}),"ActionSheet",props)}catch(e){_vendetta.logger.error(e.stack),toasts.showToast("Got error when opening ActionSheet! Please check debug logs",assets.getAssetIDByName("Smal"))}}const{Text:_Text}=components.General;function Text(param){let{variant,lineClamp,color,align,style,onPress,getChildren,children,liveUpdate}=param;const[_,forceUpdate]=common.React.useReducer(function(x){return~x},0);return common.React.useEffect(function(){if(!liveUpdate)return;const nextSecond=new Date().setMilliseconds(1e3);let interval;const timeout=setTimeout(function(){forceUpdate(),interval=setInterval(forceUpdate,1e3)},nextSecond-Date.now());return function(){clearTimeout(timeout),clearInterval(interval)}},[]),common.React.createElement(_Text,{style:[variant?TextStyleSheet[variant]:{},color?{color:resolveSemanticColor(ui.semanticColors[color])}:{},align?{textAlign:align}:{},style??{}],numberOfLines:lineClamp,onPress},getChildren?.()??children)}const{View:View$2,Pressable}=components.General;function BetterTableRowTitle(param){let{title,onPress,icon}=param;const styles=common.stylesheet.createThemedStyleSheet({androidRipple:{color:ui.semanticColors.ANDROID_RIPPLE,cornerRadius:4},icon:{width:16,height:16,marginTop:1.5,tintColor:ui.semanticColors.TEXT_MUTED}}),UseCompontent=onPress?Pressable:View$2;return React.createElement(UseCompontent,{android_ripple:styles.androidRipple,disabled:!1,accessibilityRole:"button",onPress,style:{marginBottom:8,gap:4,flexDirection:"row",alignItems:"center"}},icon&&React.createElement(common.ReactNative.Image,{style:styles.icon,source:icon,resizeMode:"cover"}),React.createElement(Text,{variant:"text-sm/semibold",color:"TEXT_MUTED"},title))}function BetterTableRowGroup(param){let{title,onTitlePress,icon,children,padding}=param;const styles=common.stylesheet.createThemedStyleSheet({main:{backgroundColor:ui.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return React.createElement(View$2,{style:{marginHorizontal:16,marginTop:16}},title?typeof title=="string"?React.createElement(BetterTableRowTitle,{title,onPress:onTitlePress,icon}):title:null,React.createElement(View$2,{style:styles.main},padding?React.createElement(View$2,{style:{paddingHorizontal:16,paddingVertical:16}},children):children))}const root="https://songspotlight.nexpid.xyz/";var constants={get api(){return vstorage.host?vstorage.host.endsWith("/")?vstorage.host:`${vstorage.host}/`:root},oauth2:{clientId:"1157745434140344321",get redirectURL(){return`${vstorage.host?vstorage.host.endsWith("/")?vstorage.host:`${vstorage.host}/`:root}api/oauth2-response`}}};function _assert_this_initialized(self){if(self===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _construct(Parent,args,Class){return _is_native_reflect_construct()?_construct=Reflect.construct:_construct=function(Parent2,args2,Class2){var a=[null];a.push.apply(a,args2);var Constructor=Function.bind.apply(Parent2,a),instance=new Constructor;return Class2&&_set_prototype_of(instance,Class2.prototype),instance},_construct.apply(null,arguments)}function _get_prototype_of(o){return _get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(o2){return o2.__proto__||Object.getPrototypeOf(o2)},_get_prototype_of(o)}function _inherits(subClass,superClass){if(typeof superClass!="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_set_prototype_of(subClass,superClass)}function _is_native_function(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _possible_constructor_return(self,call){return call&&(_type_of(call)==="object"||typeof call=="function")?call:_assert_this_initialized(self)}function _set_prototype_of(o,p){return _set_prototype_of=Object.setPrototypeOf||function(o2,p2){return o2.__proto__=p2,o2},_set_prototype_of(o,p)}function _type_of(obj){"@swc/helpers - typeof";return obj&&typeof Symbol<"u"&&obj.constructor===Symbol?"symbol":typeof obj}function _wrap_native_super(Class){var _cache2=typeof Map=="function"?new Map:void 0;return _wrap_native_super=function(Class2){if(Class2===null||!_is_native_function(Class2))return Class2;if(typeof Class2!="function")throw new TypeError("Super expression must either be null or a function");if(typeof _cache2<"u"){if(_cache2.has(Class2))return _cache2.get(Class2);_cache2.set(Class2,Wrapper)}function Wrapper(){return _construct(Class2,arguments,_get_prototype_of(this).constructor)}return Wrapper.prototype=Object.create(Class2.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_set_prototype_of(Wrapper,Class2)},_wrap_native_super(Class)}function _is_native_reflect_construct(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _create_super(Derived){var hasNativeReflectConstruct=_is_native_reflect_construct();return function(){var Super=_get_prototype_of(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_get_prototype_of(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possible_constructor_return(this,result)}}const UserStore$3=metro.findByStoreName("UserStore");let SongSpotlightAPIError=function(Error1){_inherits(SongSpotlightAPIError2,Error1);var _super=_create_super(SongSpotlightAPIError2);function SongSpotlightAPIError2(resp){_class_call_check(this,SongSpotlightAPIError2);var _this;return _this=_super.call(this,`${resp.status}: ${resp.message}${resp.error?` (${resp.error})`:""}`),_this.name=_this.constructor.name,_this}return SongSpotlightAPIError2}(_wrap_native_super(Error));function currentAuthorization(){var _UserStore_getCurrentUser,_vstorage_auth;return(_vstorage_auth=vstorage.auth)===null||_vstorage_auth===void 0?void 0:_vstorage_auth[(_UserStore_getCurrentUser=UserStore$3.getCurrentUser())===null||_UserStore_getCurrentUser===void 0?void 0:_UserStore_getCurrentUser.id]}async function getAuthorization(){const e=new Error("Unauthorized, try logging out and back in again");let auth=currentAuthorization();if(!auth)throw e;if(Date.now()>=auth.expiresAt){const x=await fetch(`${constants.api}api/refresh-access-token?refresh_token=${encodeURIComponent(auth.refreshToken)}`);if(x.status!==200)throw new SongSpotlightAPIError(await x.json());auth=await x.json(),vstorage.auth[UserStore$3.getCurrentUser().id]=auth}return auth.accessToken}async function getOauth2Response(code){const res=await fetch(`${constants.api}api/get-access-token?code=${encodeURIComponent(code)}`);if(res.status===200)return await res.json();throw new SongSpotlightAPIError(await res.json())}async function getProfileData(id){const params=new URLSearchParams;params.append("id",id);const res=await fetch(`${constants.api}api/get-profile-data?${params.toString()}`);if(res.status===200)return await res.json();throw new SongSpotlightAPIError(await res.json())}async function getSaveData(){if(!currentAuthorization())return;const res=await fetch(`${constants.api}api/get-data`,{headers:{authorization:await getAuthorization()}});if(res.status===200)return await res.json();throw new SongSpotlightAPIError(await res.json())}async function syncSaveData(songs){if(!currentAuthorization())return;const res=await fetch(`${constants.api}api/sync-data`,{method:"POST",headers:{authorization:await getAuthorization(),"content-type":"application/json"},body:JSON.stringify(songs)});if(res.status===200)return await res.json();throw new SongSpotlightAPIError(await res.json())}async function deleteSaveData(){if(!currentAuthorization())return;const res=await fetch(`${constants.api}api/delete-data`,{method:"DELETE",headers:{authorization:await getAuthorization()}});if(res.status===200)return await res.json();throw new SongSpotlightAPIError(await res.json())}let syncTimeout=0;function hsync(run){clearTimeout(syncTimeout),syncTimeout=setTimeout(run,1500)}let rcache;function check(){const snapshot=rcache?.slice();rcache=JSON.stringify(cache.data),snapshot&&snapshot!==JSON.stringify(cache.data)&&hsync(function(){return syncSaveData(cache.data.songs)})}const{pushModal,popModal}=metro.findByProps("pushModal","popModal"),OAuth2AuthorizeModal=metro.findByName("OAuth2AuthorizeModal"),UserStore$2=metro.findByStoreName("UserStore");function openOauth2Modal(){pushModal({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:OAuth2AuthorizeModal,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:constants.oauth2.clientId,redirectUri:constants.oauth2.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(param){let{location}=param;try{const code=new URL(location).searchParams.get("code"),token=await getOauth2Response(code);vstorage.auth[UserStore$2.getCurrentUser().id]=token,fillCache(),toasts.showToast("Successfully authenticated",assets.getAssetIDByName("Check"))}catch(e){toasts.showToast(String(e),assets.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return popModal("oauth2-authorize")}},closable:!0}})}const infoCache=new Map,getInfo=async function(service,type,id,signal){const key=`${service}${type}${id}`;if(infoCache.has(key))return infoCache.get(key);if(service==="spotify"){const res=await(await fetch(`https://open.spotify.com/embed/${type}/${id}`,{signal,headers:{"cache-control":"public, max-age=30"}})).text(),dt=JSON.parse(`{"props"${res.split('{"props"')[1].split("<\/script>")[0]}`);return infoCache.set(key,dt),dt}else return!1};async function getSongData(service,type,id,signal){if(service==="spotify"){var _props_pageProps_state_data,_props_pageProps_state,_props_pageProps,_props,_this;const dt=(_this=await getInfo(service,type,id,signal))===null||_this===void 0||(_props=_this.props)===null||_props===void 0||(_props_pageProps=_props.pageProps)===null||_props_pageProps===void 0||(_props_pageProps_state=_props_pageProps.state)===null||_props_pageProps_state===void 0||(_props_pageProps_state_data=_props_pageProps_state.data)===null||_props_pageProps_state_data===void 0?void 0:_props_pageProps_state_data.entity;return dt?.name&&dt?.coverArt?dt:!1}else return!1}async function getSongName(service,type,id,signal){if(service==="spotify"){var _dt_props_pageProps_state_data_entity,_dt_props_pageProps_state_data,_dt_props_pageProps_state,_dt_props_pageProps,_dt_props;const dt=await getInfo(service,type,id,signal);return(dt==null||(_dt_props=dt.props)===null||_dt_props===void 0||(_dt_props_pageProps=_dt_props.pageProps)===null||_dt_props_pageProps===void 0||(_dt_props_pageProps_state=_dt_props_pageProps.state)===null||_dt_props_pageProps_state===void 0||(_dt_props_pageProps_state_data=_dt_props_pageProps_state.data)===null||_dt_props_pageProps_state_data===void 0||(_dt_props_pageProps_state_data_entity=_dt_props_pageProps_state_data.entity)===null||_dt_props_pageProps_state_data_entity===void 0?void 0:_dt_props_pageProps_state_data_entity.name)??!1}else return!1}async function validateSong(service,type,id,signal){if(service==="spotify"){var _page_props,_page;return((_page=(await getInfo(service,type,id,signal)).page)===null||_page===void 0||(_page_props=_page.props)===null||_page_props===void 0?void 0:_page_props.status)!==404}else return!1}const rebuildLink=function(service,type,id){return service==="spotify"?`https://open.spotify.com/${type}/${id}`:void 0};async function openSpotify(uri){await common.ReactNative.Linking.canOpenURL(uri)?common.url.openDeeplink(uri):await common.ReactNative.Linking.canOpenURL("market://details?id=com.spotify.music")?common.url.openDeeplink("market://details?id=com.spotify.music"):common.url.openDeeplink("itms-apps://itunes.apple.com/app/id324684580")}function PendingSongName(param){let{service,type,id,normal}=param;const[songName,setSongName]=common.React.useState(null);return common.React.useEffect(function(){setSongName(void 0),id&&getSongName(service,type,id).then(function(s){return setSongName(s!==!1?s:"N/A")})},[id]),common.React.createElement(Text,{variant:normal?"text-md/semibold":"text-md/medium",color:normal?"TEXT_NORMAL":"TEXT_MUTED"},songName??"-")}const{FormRow:FormRow$1}=components.Forms,destructiveText={color:"TEXT_DANGER",variant:"text-md/semibold"};function SongInfoSheet(param){let{song,remove,showAdd}=param;const styles=common.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:ui.semanticColors.TEXT_DANGER}});return React.createElement(ActionSheet,null,React.createElement(ActionSheetContentContainer,null,React.createElement(ActionSheetTitleHeader,{title:"Edit Song",trailing:React.createElement(ActionSheetCloseButton,{onPress:hideActionSheet})}),song.service==="spotify"&&React.createElement(FormRow$1,{label:"Open in Spotify",leading:React.createElement(FormRow$1.Icon,{source:assets.getAssetIDByName("img_account_sync_spotify_light_and_dark")}),onPress:function(){openSpotify(`spotify://${song.type}/${song.id}`),hideActionSheet()}}),React.createElement(FormRow$1,{label:"Copy link",leading:React.createElement(FormRow$1.Icon,{source:assets.getAssetIDByName("copy")}),onPress:function(){common.clipboard.setString(rebuildLink(song.service,song.type,song.id)),toasts.showToast("Copied to clipboard.",assets.getAssetIDByName("toast_copy_link")),hideActionSheet()}}),showAdd&&React.createElement(FormRow$1,{label:"Add to your profile",leading:React.createElement(FormRow$1.Icon,{source:assets.getAssetIDByName("ic_pin")}),onPress:function(){var _cache_data;hideActionSheet();const songs=(_cache_data=cache.data)===null||_cache_data===void 0?void 0:_cache_data.songs;if(!songs)return;const available=songs.findIndex(function(x){return x===null});if(available===-1)return toasts.showToast("No space left!",assets.getAssetIDByName("Small"));songs[available]=song,check(),toasts.showToast("Added to your profile",assets.getAssetIDByName("Check"))}}),remove&&React.createElement(FormRow$1,{label:React.createElement(Text,destructiveText,"Remove song"),leading:React.createElement(FormRow$1.Icon,{style:styles.destructiveIcon,source:assets.getAssetIDByName("trash")}),onPress:function(){remove(),toasts.showToast("Removed",assets.getAssetIDByName("toast_trash")),hideActionSheet()}})))}const{ScrollView,View:View$1}=components.General,{FormRow}=components.Forms,UserStore$1=metro.findByStoreName("UserStore");function settings(){storage.useProxy(cache),storage.useProxy(vstorage),check();const styles=common.stylesheet.createThemedStyleSheet({song:{backgroundColor:ui.semanticColors.BG_MOD_FAINT,borderRadius:8},serviceFrame:{height:24,width:24,backgroundColor:ui.semanticColors.BG_MOD_FAINT,borderRadius:2147483647}}),isAuthed=!!currentAuthorization(),hasData=!!cache.data;return React.createElement(ScrollView,null,React.createElement(BetterTableRowGroup,{title:"Songs",icon:assets.getAssetIDByName("abc"),padding:!0},isAuthed&&hasData?React.createElement(View$1,{style:{flexDirection:"column",gap:8}},cache.data.songs.map(function(x,i){return React.createElement(FormRow,{label:x===null?"Press to add song in this position":React.createElement(PendingSongName,{service:x.service,type:x.type,id:x.id,normal:!0}),leading:x===null?React.createElement(View$1,{style:styles.serviceFrame}):React.createElement(common.ReactNative.Image,{style:styles.serviceFrame,source:assets.getAssetIDByName("img_account_sync_spotify_light_and_dark")}),onLongPress:function(){return x&&openSheet(SongInfoSheet,{song:x,remove:function(){return cache.data.songs[i]=null}})},onPress:function(){return alerts.showInputAlert({title:"Add song",placeholder:["https://open.spotify.com/track/ABC","https://open.spotify.com/album/ABC","https://open.spotify.com/playlist/ABC","https://spotify.link/ABC"].sort(function(){return Math.random()>.5?1:-1})[0],initialValue:x&&rebuildLink(x.service,x.type,x.id),cancelText:"Cancel",confirmText:"Save",onConfirm:async function(val){var _val_match;const url=(_val_match=val.match(constants$1.HTTP_REGEX_MULTI))===null||_val_match===void 0?void 0:_val_match[0];if(!url)throw new Error("Invalid link!");let base=new URL(url),host=base.hostname,service,type,id;if(host==="spotify.link"&&(service="spotify",base=new URL((await fetch(url)).url),host=base.hostname),host==="open.spotify.com"){service="spotify";const[_,_type,_id]=base.pathname.split("/");["album","track","playlist"].includes(_type)&&_id&&(type=_type,id=_id)}if(!service||!type||!id)throw new Error("Missing service, type or id!");if(!await validateSong(service,type,id))throw new Error("Invalid song!");cache.data.songs[i]={service,type,id}}})},style:styles.song})})):isAuthed?React.createElement(common.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}}):React.createElement(Text,{variant:"text-md/semibold",color:"TEXT_NORMAL",align:"center"},"Authenticate first to manage your songs")),React.createElement(BetterTableRowGroup,{title:"Authentication",icon:assets.getAssetIDByName("lock")},currentAuthorization()?React.createElement(React.Fragment,null,React.createElement(FormRow,{label:"Log out",subLabel:"Logs you out of SongSpotlight",leading:React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_logout_24px")}),onPress:function(){delete vstorage.auth[UserStore$1.getCurrentUser().id],delete cache.data,toasts.showToast("Successfully logged out",assets.getAssetIDByName("ic_logout_24px"))}}),React.createElement(FormRow,{label:"Delete data",subLabel:"Deletes your SongSpotlight data",leading:React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("trash")}),onPress:async function(){await deleteSaveData(),delete vstorage.auth[UserStore$1.getCurrentUser().id],delete cache.data,toasts.showToast("Successfully deleted data",assets.getAssetIDByName("trash"))}})):React.createElement(FormRow,{label:"Authenticate",leading:React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("copy")}),trailing:FormRow.Arrow,onPress:openOauth2Modal})),React.createElement(View$1,{style:{height:12}}))}const WebView=metro.find(function(x){return x?.WebView&&!x.default}).WebView,Svg=metro.findByProps("SvgXml");metro.findByProps("isJoi"),metro.findByProps("useSharedValue"),metro.findByProps("FlashList").FlashList,metro.findByName("create"),common.ReactNative.NativeModules.MMKVManager,common.ReactNative.NativeModules.DCDFileManager??common.ReactNative.NativeModules.RTNFileManager,common.ReactNative.NativeModules.BundleUpdaterManager,common.ReactNative.NativeModules.DCDSoundManager,common.ReactNative.NativeModules.RNFSManager;var next=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.7 1C12.5143 1 12.3363 1.07375 12.205 1.20503C12.0738 1.3363 12 1.51435 12 1.7V6.85L2.05 1.107C1.94368 1.04561 1.82308 1.01327 1.7003 1.01322C1.57753 1.01316 1.4569 1.0454 1.35053 1.1067C1.24415 1.16799 1.15576 1.25618 1.09424 1.36243C1.03271 1.46867 1.00021 1.58923 1 1.712V14.287C0.999863 14.4099 1.03211 14.5308 1.09349 14.6373C1.15487 14.7438 1.24322 14.8323 1.34966 14.8938C1.4561 14.9553 1.57686 14.9877 1.6998 14.9878C1.82275 14.9878 1.94353 14.9555 2.05 14.894L12 9.149V14.3C12 14.4857 12.0738 14.6637 12.205 14.795C12.3363 14.9262 12.5143 15 12.7 15H14.3C14.4857 15 14.6637 14.9262 14.795 14.795C14.9262 14.6637 15 14.4857 15 14.3V1.7C15 1.51435 14.9262 1.3363 14.795 1.20503C14.6637 1.07375 14.4857 1 14.3 1H12.7Z" fill="white"/>
</svg>
`,pause=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1 12C1 5.925 5.925 1 12 1C18.075 1 23 5.925 23 12C23 18.075 18.075 23 12 23C5.925 23 1 18.075 1 12ZM8.5 7C8.36739 7 8.24021 7.05268 8.14645 7.14645C8.05268 7.24021 8 7.36739 8 7.5V16.5C8 16.6326 8.05268 16.7598 8.14645 16.8536C8.24021 16.9473 8.36739 17 8.5 17H10.5C10.6326 17 10.7598 16.9473 10.8536 16.8536C10.9473 16.7598 11 16.6326 11 16.5V7.5C11 7.36739 10.9473 7.24021 10.8536 7.14645C10.7598 7.05268 10.6326 7 10.5 7H8.5ZM13.5 7C13.3674 7 13.2402 7.05268 13.1464 7.14645C13.0527 7.24021 13 7.36739 13 7.5V16.5C13 16.6326 13.0527 16.7598 13.1464 16.8536C13.2402 16.9473 13.3674 17 13.5 17H15.5C15.6326 17 15.7598 16.9473 15.8536 16.8536C15.9473 16.7598 16 16.6326 16 16.5V7.5C16 7.36739 15.9473 7.24021 15.8536 7.14645C15.7598 7.05268 15.6326 7 15.5 7H13.5Z" fill="white"/>
</svg>
`,play=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1 12C1 5.925 5.925 1 12 1C18.075 1 23 5.925 23 12C23 18.075 18.075 23 12 23C5.925 23 1 18.075 1 12ZM9.75 7.433C9.67399 7.38912 9.58777 7.36601 9.5 7.36601C9.41224 7.36601 9.32601 7.38911 9.25001 7.433C9.174 7.47688 9.11088 7.54 9.06699 7.616C9.02311 7.69201 9 7.77823 9 7.866V16.134C9 16.2218 9.02311 16.308 9.06699 16.384C9.11088 16.46 9.174 16.5231 9.25001 16.567C9.32601 16.6109 9.41224 16.634 9.5 16.634C9.58777 16.634 9.67399 16.6109 9.75 16.567L16.911 12.433C16.987 12.3891 17.0501 12.326 17.094 12.25C17.1379 12.174 17.161 12.0878 17.161 12C17.161 11.9122 17.1379 11.826 17.094 11.75C17.0501 11.674 16.987 11.6109 16.911 11.567L9.75 7.433Z" fill="white"/>
</svg>
`,spotifyAudioWebView=`<!doctype html>
<html></html>
<script>
  const RNWV = window.ReactNativeWebView;

  /** @type {(HTMLAudioElement | null)[]} */
  const audios = AUDIOS_VARIABLE.map((x) => (x ? new Audio(x) : null));
  let position = 0;

  /** @argument enabled {boolean} */
  const playback = (enabled) => {
    audios.forEach((x, i) => {
      if (!x) return;
      if (i === position && enabled) x.play();
      else {
        if (i !== position) x.currentTime = 0;
        x.pause();
      }
    });
  };

  audios.forEach((x) =>
    x?.addEventListener("ended", () => RNWV.postMesssage("ended")),
  );

  window.addEventListener("message", (ev) => {
    const { action, pos } = ev.data;
    if (!action) return;

    if (pos !== undefined) position = audios[pos] ? pos : 0;

    if (action === "play") playback(true);
    else if (action === "pause") playback(false);
  });
<\/script>
`;const{View}=components.General,AnimatedPressable=common.ReactNative.Animated.createAnimatedComponent(common.ReactNative.Pressable),UserProfileSection=metro.findByName("UserProfileSection"),{YouScreenProfileCard}=metro.findByProps("YouScreenProfileCard"),{TableRowGroupTitle}=metro.findByProps("TableRowGroupTitle"),UserStore=metro.findByStoreName("UserStore"),playingRn=new Map,SpotifySongEmbed=function(param){let{song,showAdd,remove}=param;var _songData_audioPreview,_songData_audioPreview1;const[playing,setPlaying]=common.React.useState(!1),[position,setPosition]=common.React.useState(0),[songData,setSongData]=common.React.useState(void 0),ratio=songData&&songData.type==="track"||song.type==="track"?600/152:600/352,audioWebviewRef=common.React.useRef(null),skey=common.React.useRef(Math.random().toString()).current;common.React.useEffect(function(){var _audioWebviewRef_current;playing&&playingRn.forEach(function(x,k){return k!==skey&&x()}),(_audioWebviewRef_current=audioWebviewRef.current)===null||_audioWebviewRef_current===void 0||_audioWebviewRef_current.injectJavaScript(`window.postMessage(${JSON.stringify({action:playing?"play":"pause",pos:position})})`)},[playing,position]),playingRn.set(skey,function(){return setPlaying(!1)}),common.React.useEffect(function(){return function(){playingRn.delete(skey)}},[]);const background=songData&&(songData.coverArt.extractedColors.colorLight?resolveCustomSemantic(songData.coverArt.extractedColors.colorDark.hex,songData.coverArt.extractedColors.colorLight.hex):songData.coverArt.extractedColors.colorDark.hex),styles=common.stylesheet.createThemedStyleSheet({emptyCard:{width:"100%",aspectRatio:ratio,backgroundColor:ui.semanticColors.BG_MOD_FAINT,borderRadius:12,justifyContent:"center",alignItems:"center"},noImage:{tintColor:ui.semanticColors.TEXT_DANGER,width:36,height:36},card:{width:"100%",backgroundColor:background&&lerp(background,"#000000",.15),aspectRatio:ratio,borderRadius:12,flexDirection:"column"},cardFirst:{backgroundColor:background,width:"100%",height:"100%",borderRadius:12},cardFirstContent:{flexDirection:"row",gap:8,padding:10},cardImage:{height:"100%",aspectRatio:1,borderRadius:8,backgroundColor:ui.semanticColors.BG_MOD_SUBTLE,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:4.65,elevation:8},cardContent:{width:"90%",flexDirection:"column",gap:2,justifyContent:"center",flexGrow:0,flexShrink:0},cardContentArtist:{flexDirection:"row",gap:4,alignItems:"center",flexGrow:0,flexShrink:0},cardContentTag:{backgroundColor:"#ffffffb3",paddingHorizontal:6,paddingVertical:1,borderRadius:4,color:"#000000"},cardOther:{position:"absolute",width:"100%",height:"100%",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-end",padding:10},cardOtherBottom:{flexDirection:"row-reverse",alignItems:"center",gap:4},cardTracklist:{height:"100%",paddingHorizontal:8,flexDirection:"column"},cardTracklistEntry:{backgroundColor:background&&lerp(background,"#000000",.25),borderRadius:5,flexDirection:"column",padding:8,flexGrow:0,flexShrink:0},cardTracklistEntryUnplayable:{backgroundColor:background&&lerp(background,"#000000",.2)},cardTracklistEntryPlaying:{backgroundColor:background&&lerp(background,"#000000",.35)},cardTracklistEntryTitle:{width:"95%",color:"#ffffff"},cardTracklistEntryOther:{position:"absolute",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",alignItems:"flex-end",padding:5},webview:{display:"none",width:0,height:0,opacity:0},secondaryText:{opacity:.7,color:"#ffffff"},unplayableItem:{opacity:.5},androidRipple:{color:ui.semanticColors.ANDROID_RIPPLE,cornerRadius:2147483647},androidRippleTwo:{color:ui.semanticColors.ANDROID_RIPPLE,cornerRadius:8}}),triggerController=common.React.useRef(null),trigger=function(){var _triggerController_current;(_triggerController_current=triggerController.current)===null||_triggerController_current===void 0||_triggerController_current.abort();const controller=new AbortController;triggerController.current=controller,setSongData(void 0),getSongData(song.service,song.type,song.id,controller.signal).then(function(x){const res=x??!1;res&&res.type!=="track"&&(res.trackList=res.trackList.slice(0,50)),setSongData(res)}).catch(function(e){return e?.name!=="AbortError"&&(console.error("[SongSpotlight] Failed to get song data!"),_vendetta.logger.error(`Failed to get song data!
${e.stack}`),toasts.showToast("Failed to get song data!",assets.getAssetIDByName("Small")),setSongData(!1))})};common.React.useEffect(function(){return trigger(),function(){var _triggerController_current;return(_triggerController_current=triggerController.current)===null||_triggerController_current===void 0?void 0:_triggerController_current.abort()}},[]);const covers=songData&&songData.coverArt.sources,tracklistRef=common.React.useRef();common.React.useEffect(function(){var _tracklistRef_current;(_tracklistRef_current=tracklistRef.current)===null||_tracklistRef_current===void 0||_tracklistRef_current.scrollToIndex({animated:!0,index:position,viewOffset:16})},[position]);const TracklistEntry=function(param2){let{item,selected,playable,jump,more}=param2;return common.React.createElement(AnimatedPressable,{android_ripple:styles.androidRippleTwo,style:[styles.cardTracklistEntry,!playable&&styles.cardTracklistEntryUnplayable,selected&&styles.cardTracklistEntryPlaying],onPress:jump,onLongPress:more},common.React.createElement(Text,{style:[styles.cardTracklistEntryTitle,!playable&&styles.unplayableItem],variant:selected?"text-sm/bold":"text-sm/semibold",lineClamp:1},item.title),common.React.createElement(View,{style:styles.cardContentArtist},item.isExplicit&&common.React.createElement(Text,{variant:"text-xs/semibold",style:[styles.cardContentTag,!playable&&styles.unplayableItem]},"E"),common.React.createElement(Text,{variant:selected?"text-xs/bold":"text-xs/semibold",style:[styles.secondaryText,!playable&&styles.unplayableItem],lineClamp:1},item.subtitle)),common.React.createElement(View,{style:styles.cardTracklistEntryOther},common.React.createElement(common.ReactNative.Pressable,{android_ripple:styles.androidRipple,onPress:more},common.React.createElement(common.ReactNative.Image,{source:assets.getAssetIDByName("ic_feed_more")}))))},trackPlayable=songData&&songData.type==="track"?songData.isPlayable&&!!(!((_songData_audioPreview=songData.audioPreview)===null||_songData_audioPreview===void 0)&&_songData_audioPreview.url):!0,entryHeight=8*2+TextStyleSheet["text-sm/normal"].lineHeight+TextStyleSheet["text-xs/normal"].lineHeight+1.4;return songData?common.React.createElement(common.React.Fragment,null,common.React.createElement(View,{style:styles.card,pointerEvents:"box-none"},common.React.createElement(View,{style:[styles.cardFirst,songData.type!=="track"&&{height:"40%"}]},common.React.createElement(View,{style:styles.cardFirstContent},common.React.createElement(common.ReactNative.Image,{style:styles.cardImage,source:covers.sort(function(a,b){return a.width-b.width}).map(function(x){return{uri:x.url,width:x.width,height:x.height}})}),common.React.createElement(View,{style:styles.cardContent},common.React.createElement(Text,{variant:"text-sm/bold",style:{color:"#ffffff"},lineClamp:1},songData.title),songData.type==="track"?common.React.createElement(View,{style:styles.cardContentArtist},songData.isExplicit&&common.React.createElement(Text,{variant:"text-xs/semibold",style:styles.cardContentTag},"E"),common.React.createElement(Text,{variant:"text-xs/semibold",style:styles.secondaryText,lineClamp:1},songData.artists.map(function(x){return x.name}).join(", "))):common.React.createElement(Text,{variant:"text-xs/semibold",style:[styles.secondaryText,{color:"#ffffff"}],lineClamp:1},songData.subtitle))),common.React.createElement(View,{style:styles.cardOther},common.React.createElement(common.ReactNative.Pressable,{android_ripple:styles.androidRipple,onPress:function(){return openSheet(SongInfoSheet,{song,showAdd,remove})}},common.React.createElement(common.ReactNative.Image,{source:assets.getAssetIDByName("ic_feed_more")})),common.React.createElement(View,{style:styles.cardOtherBottom},common.React.createElement(common.ReactNative.Pressable,{android_ripple:styles.androidRipple,onPress:function(){return setPlaying(!playing)},style:!trackPlayable&&styles.unplayableItem},common.React.createElement(Svg.SvgXml,{width:30,height:30,xml:playing?pause:play})),songData.type!=="track"&&common.React.createElement(common.ReactNative.Pressable,{android_ripple:styles.androidRipple,onPress:function(){setPlaying(!1);const nextPos=position+1;if(nextPos<songData.trackList.length){var _item_audioPreview;const item=songData.trackList[nextPos];if(item.isPlayable&&!((_item_audioPreview=item.audioPreview)===null||_item_audioPreview===void 0)&&_item_audioPreview.url)setPosition(nextPos),setPlaying(!0);else{const nextIndex=songData.trackList.findIndex(function(x,i){var _x_audioPreview;return i>nextPos&&x.isPlayable&&!!(!((_x_audioPreview=x.audioPreview)===null||_x_audioPreview===void 0)&&_x_audioPreview.url)});nextIndex!==-1&&(setPosition(nextIndex),setPlaying(!0)),toasts.showToast("The next song cannot be played")}}else setPosition(0)}},common.React.createElement(Svg.SvgXml,{width:20,height:20,xml:next}))))),songData.type!=="track"&&common.React.createElement(common.ReactNative.FlatList,{nestedScrollEnabled:!0,ref:tracklistRef,getItemLayout:function(_,index2){return{length:entryHeight,offset:8*(index2+1)+entryHeight*index2,index:index2}},style:styles.cardTracklist,data:songData.trackList,ListHeaderComponent:function(){return common.React.createElement(View,{style:{height:8}})},ListFooterComponent:function(){return common.React.createElement(View,{style:{height:8}})},ItemSeparatorComponent:function(){return common.React.createElement(View,{style:{height:8}})},renderItem:function(param2){let{item,index:index2}=param2;var _item_audioPreview;const playable=item.isPlayable&&!!(!((_item_audioPreview=item.audioPreview)===null||_item_audioPreview===void 0)&&_item_audioPreview.url);return common.React.createElement(TracklistEntry,{item,selected:index2===position,playable,jump:function(){if(playable)setPosition(index2),setPlaying(!0);else{const nextIndex=songData.trackList.findIndex(function(x,i){var _x_audioPreview;return i>index2&&x.isPlayable&&!!(!((_x_audioPreview=x.audioPreview)===null||_x_audioPreview===void 0)&&_x_audioPreview.url)});return nextIndex!==-1&&(setPosition(nextIndex),setPlaying(!0)),toasts.showToast("This song cannot be played")}},more:function(){return openSheet(SongInfoSheet,{song:{service:"spotify",type:"track",id:item.uid},showAdd})}})}})),songData.isPlayable&&common.React.createElement(WebView,{source:{html:spotifyAudioWebView.replace(/AUDIOS_VARIABLE/g,JSON.stringify(songData.type==="track"?[((_songData_audioPreview1=songData.audioPreview)===null||_songData_audioPreview1===void 0?void 0:_songData_audioPreview1.url)??null]:songData.trackList.map(function(x){var _x_audioPreview;return((_x_audioPreview=x.audioPreview)===null||_x_audioPreview===void 0?void 0:_x_audioPreview.url)??null})))},style:styles.webview,mediaPlaybackRequiresUserAction:!1,onMessage:function(param2){let{nativeEvent:{data}}=param2;if(data==="ended"&&(setPlaying(!1),songData.type!=="track")){const nextPos=position+1;nextPos<songData.trackList.length?(setPosition(nextPos),setPlaying(!0)):setPosition(0)}},ref:audioWebviewRef,pointerEvents:"none"})):songData===!1?common.React.createElement(View,{style:styles.emptyCard},common.React.createElement(common.ReactNative.Pressable,{android_ripple:styles.androidRipple,onPress:trigger},common.React.createElement(common.ReactNative.Image,{style:styles.noImage,source:assets.getAssetIDByName("ic_message_retry"),resizeMode:"contain"}))):common.React.createElement(View,{style:styles.emptyCard},common.React.createElement(common.ReactNative.ActivityIndicator,{size:"large"}))};function UserProfileSongs(param){let{userId,you}=param;const[songs,setSongs]=common.React.useState(void 0),youId=UserStore.getCurrentUser().id;common.React.useEffect(function(){youId===userId&&cache.data?setSongs(cache.data.songs):getProfileData(userId).then(function(x){return setSongs(x?.songs??[])}).catch(function(e){return e?.name!=="AbortError"&&(console.error("[SongSpotlight] Failed to get profile data!"),_vendetta.logger.error(`Failed to get profile data!
${e.stack}`),toasts.showToast("Failed to get profile data!",assets.getAssetIDByName("Small")),setSongs([]))})},[]);const hide=songs&&!songs.filter(function(x){return!!x}).length,content=songs?songs.map(function(x,i){return x?x.service==="spotify"&&common.React.createElement(SpotifySongEmbed,{song:x,showAdd:userId!==youId&&!!currentAuthorization(),remove:userId===youId&&function(){var _cache_data;const songs2=(_cache_data=cache.data)===null||_cache_data===void 0?void 0:_cache_data.songs;songs2&&(songs2[i]=null,check())}}):null}):common.React.createElement(common.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}});return!hide&&(you?common.React.createElement(YouScreenProfileCard,null,common.React.createElement(TableRowGroupTitle,{title:"Song Spotlight"}),common.React.createElement(View,{style:{flexDirection:"column",gap:8,marginTop:4}},content)):common.React.createElement(UserProfileSection,{title:"Song Spotlight",showContainer:!0},common.React.createElement(View,{style:{flexDirection:"column",gap:8,paddingHorizontal:8,paddingVertical:8}},content)))}const UserProfileBio=metro.findByName("UserProfileBio",!1),YouAboutMeCard=metro.findByName("YouAboutMeCard",!1);function patcher(){const patches=new Array;return patches.push(patcher$1.after("default",UserProfileBio,function(param,ret){let[x]=param;var _x_displayProfile;return common.React.createElement(common.React.Fragment,{},[(x==null||(_x_displayProfile=x.displayProfile)===null||_x_displayProfile===void 0?void 0:_x_displayProfile.userId)&&common.React.createElement(UserProfileSongs,{userId:x.displayProfile.userId,you:!1}),ret])})),patches.push(patcher$1.after("default",YouAboutMeCard,function(param,ret){let[{userId}]=param;return common.React.createElement(common.React.Fragment,{},[common.React.createElement(UserProfileSongs,{userId,you:!0}),ret])})),function(){return patches.forEach(function(x){return x()})}}const vstorage=plugin.storage;let _cache;const cache=storage.wrapSync(storage.createStorage({get:function(){return _cache},set:function(x){_cache=x}}));async function fillCache(){try{cache.data=await getSaveData()}catch{return}}let unpatch;var index={onLoad:function(){vstorage.auth??(vstorage.auth={}),currentAuthorization()&&fillCache(),unpatch=patcher()},onUnload:function(){return unpatch?.()},settings};return exports.cache=cache,exports.default=index,exports.fillCache=fillCache,exports.vstorage=vstorage,Object.defineProperty(exports,"__esModule",{value:!0}),exports})({},vendetta.plugin,vendetta.storage,vendetta.constants,vendetta.metro,vendetta.metro.common,vendetta.ui,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta,vendetta.patcher);
