(function(exports,plugin,common,storage,alerts,assets,components,toasts,ui,_vendetta,metro,utils){"use strict";var _findByProps,_findByProps1,_findByProps2,_findByProps3,_findByProps4;const ThemeStore=metro.findByStoreName("ThemeStore");metro.findByProps("triggerHaptic");const colorModule=metro.findByProps("colors","unsafe_rawColors"),colorResolver=colorModule?.internal??colorModule?.meta,TextStyleSheet=metro.findByProps("TextStyleSheet").TextStyleSheet,ActionSheet=((_findByProps=metro.findByProps("ActionSheet"))===null||_findByProps===void 0?void 0:_findByProps.ActionSheet)??metro.find(function(x){var _x_render;return((_x_render=x.render)===null||_x_render===void 0?void 0:_x_render.name)==="ActionSheet"}),LazyActionSheet$1=metro.findByProps("openLazy","hideActionSheet"),{openLazy,hideActionSheet}=LazyActionSheet$1,{ActionSheetTitleHeader,ActionSheetCloseButton,ActionSheetContentContainer}=metro.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");(_findByProps1=metro.findByProps("ActionSheetRow"))===null||_findByProps1===void 0||_findByProps1.ActionSheetRow,metro.findByName("Navigator")??((_findByProps2=metro.findByProps("Navigator"))===null||_findByProps2===void 0||_findByProps2.Navigator),((_findByProps3=metro.findByProps("getRenderCloseButton"))===null||_findByProps3===void 0?void 0:_findByProps3.getRenderCloseButton)??((_findByProps4=metro.findByProps("getHeaderCloseButton"))===null||_findByProps4===void 0||_findByProps4.getHeaderCloseButton),metro.findByProps("popModal","pushModal");function resolveSemanticColor(color){let theme=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ThemeStore.theme;return colorResolver.resolveSemanticColor(theme,color)}function getUserAvatar(user,animated){const isPomelo=user.discriminator==="0";return user.avatar?`https://cdn.discordapp.com/avatars/${user.id}/${`${user.avatar}.png`}`:`https://cdn.discordapp.com/embed/avatars/${isPomelo?(parseInt(user.id)>>22)%6:parseInt(user.discriminator)%5}`}function openSheet(sheet,props){try{openLazy(new Promise(function(x){return x({default:sheet})}),"ActionSheet",props)}catch(e){_vendetta.logger.error(e.stack),toasts.showToast("Got error when opening ActionSheet! Please check debug logs",assets.getAssetIDByName("Smal"))}}const{Text:_Text$1}=components.General;function Text$1(param){let{variant,lineClamp,color,align,style,onPress,getChildren,children,liveUpdate}=param;const[_,forceUpdate]=common.React.useReducer(function(x){return~x},0);return common.React.useEffect(function(){if(!liveUpdate)return;const nextSecond=new Date().setMilliseconds(1e3);let interval;const timeout=setTimeout(function(){forceUpdate(),interval=setInterval(forceUpdate,1e3)},nextSecond-Date.now());return function(){clearTimeout(timeout),clearInterval(interval)}},[]),common.React.createElement(_Text$1,{style:[variant?TextStyleSheet[variant]:{},color?{color:resolveSemanticColor(ui.semanticColors[color])}:{},align?{textAlign:align}:{},style??{}],numberOfLines:lineClamp,onPress},getChildren?.()??children)}const{View:View$7,Pressable:Pressable$1}=components.General;function BetterTableRowTitle(param){let{title,onPress,icon}=param;const styles2=common.stylesheet.createThemedStyleSheet({androidRipple:{color:ui.semanticColors.ANDROID_RIPPLE,cornerRadius:4},icon:{width:16,height:16,marginTop:1.5,tintColor:ui.semanticColors.TEXT_MUTED}}),UseCompontent=onPress?Pressable$1:View$7;return React.createElement(UseCompontent,{android_ripple:styles2.androidRipple,disabled:!1,accessibilityRole:"button",onPress,style:{marginBottom:8,gap:4,flexDirection:"row",alignItems:"center"}},icon&&React.createElement(common.ReactNative.Image,{style:styles2.icon,source:icon,resizeMode:"cover"}),React.createElement(Text$1,{variant:"text-sm/semibold",color:"TEXT_MUTED"},title))}function BetterTableRowGroup(param){let{title,onTitlePress,icon,children,padding}=param;const styles2=common.stylesheet.createThemedStyleSheet({main:{backgroundColor:ui.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return React.createElement(View$7,{style:{marginHorizontal:16,marginTop:16}},title?typeof title=="string"?React.createElement(BetterTableRowTitle,{title,onPress:onTitlePress,icon}):title:null,React.createElement(View$7,{style:styles2.main},padding?React.createElement(View$7,{style:{paddingHorizontal:16,paddingVertical:16}},children):children))}const{View:View$6}=components.General;function LineDivider(param){let{addPadding}=param;const styles2=common.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:ui.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return React.createElement(View$6,{style:[{marginTop:16,marginBottom:16},addPadding&&{marginHorizontal:16}]},React.createElement(View$6,{style:styles2.line}))}function SuperAwesomeIcon(param){let{onPress,onLongPress,icon,style,destructive,color}=param;const styles2=common.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:ui.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:ui.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:ui.semanticColors.TEXT_DANGER}});return React.createElement(common.ReactNative.TouchableOpacity,{onPress,onLongPress},React.createElement(common.ReactNative.Image,{style:[typeof style=="string"?style==="header"?styles2.headerStyleIcon:styles2.cardStyleIcon:style,destructive&&styles2.destructiveIcon,color&&{tintColor:color}].filter(function(x){return!!x}),source:icon}))}function managePage(options,navigation){for(var _len=arguments.length,deps=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++)deps[_key-2]=arguments[_key];navigation||(navigation=common.NavigationNative.useNavigation()),common.React.useEffect(function(){navigation.setOptions(options)},[navigation,...deps])}metro.find(function(x){return x?.WebView&&!x.default}).WebView,metro.findByProps("SvgXml");const Joi=metro.findByProps("isJoi");metro.findByProps("useSharedValue"),metro.findByProps("FlashList").FlashList,metro.findByName("create"),common.ReactNative.NativeModules.MMKVManager,common.ReactNative.NativeModules.DCDFileManager??common.ReactNative.NativeModules.RTNFileManager,common.ReactNative.NativeModules.BundleUpdaterManager,common.ReactNative.NativeModules.DCDSoundManager,common.ReactNative.NativeModules.RNFSManager;const{ScrollView:ScrollView$1,Text:DText}=components.General,{FormSection}=components.Forms;let forceUpdateLiveRawActivityView;const LiveRawActivityView=function(){const[_,forceUpdate]=common.React.useReducer(function(x){return~x},0);forceUpdateLiveRawActivityView=forceUpdate;const styles2=common.stylesheet.createThemedStyleSheet({code:{fontFamily:common.constants.Fonts.CODE_SEMIBOLD||common.constants.Fonts.CODE_NORMAL,includeFontPadding:!1,color:ui.semanticColors.TEXT_NORMAL}});return common.React.createElement(ScrollView$1,{style:{flex:1,marginBottom:50}},common.React.createElement(FormSection,{title:"Live Raw Activity"},debug.lastRawActivity?common.React.createElement(DText,{style:styles2.code},JSON.stringify(debug.lastRawActivity,void 0,3)):vstorage.settings.display?common.React.createElement(Text$1,{variant:"text-md/semibold"},"Display activity setting is disabled. You need to actually enable it for the raw activity to show up lmao"):common.React.createElement(Text$1,{variant:"text-md/semibold",onPress:function(){return dispatchActivityIfPossible()}},"No last raw activity yet. Tap text to force update")),common.React.createElement(FormSection,{title:"Info"},common.React.createElement(Text$1,{variant:"text-md/semibold",color:"TEXT_NORMAL"},"Last raw activity update:"," ",debug.lastRawActivityTimestamp?new Date(debug.lastRawActivityTimestamp).toLocaleString("en-US"):"-")))};function openLiveRawActivityView(navigation){navigation.push("VendettaCustomPage",{render:LiveRawActivityView,title:"Live RawActivity"})}const{Text:_Text}=components.General;var RichText;(function(RichText2){function Bold(param){let{children,onPress}=param;return React.createElement(Text$1,{variant:"text-md/bold",onPress},children)}RichText2.Bold=Bold;function Underline(param){let{children,onPress}=param;return React.createElement(_Text,{style:{textDecorationLine:"underline"},onPress},children)}RichText2.Underline=Underline})(RichText||(RichText={}));const apiUrl="https://discord.com/api/v9/",{getToken}=metro.findByProps("getToken");async function getApplications(){return await(await utils.safeFetch(`${apiUrl}applications?with_team_applications=true`,{headers:{authorization:getToken()}})).json()}async function getApplicationAssets(applicationId){return await(await utils.safeFetch(`${apiUrl}oauth2/applications/${applicationId}/assets`,{cache:"no-store",headers:{authorization:getToken()}})).json()}const proxyAssetCache={};async function getExternalAsset(url){if(proxyAssetCache[url])return proxyAssetCache[url];proxyAssetCache[url]="pending";let link=(await(await fetch(`${apiUrl}applications/0/external-assets`,{method:"POST",headers:{authorization:getToken(),"content-type":"application/json"},body:JSON.stringify({urls:[url]})})).json())[0].external_asset_path;return link.startsWith("https://media.discordapp.net")&&(link=link.split("/").slice(3).join("/")),proxyAssetCache[url]=link,link}const{View:View$5,Image:Image$2}=components.General;let headerRightCallback;const ApplicationList=function(){const navigation=common.NavigationNative.useNavigation(),[search,setSearch]=common.React.useState(""),[data,setData]=common.React.useState();headerRightCallback=function(){return!wentBack&&alerts.showInputAlert({title:"Custom App ID",placeholder:"123",confirmText:"Use",confirmColor:"blue",onConfirm:function(txt){if(txt.match(/^\s*$/))return toasts.showToast("App ID cannot be empty",assets.getAssetIDByName("Small"));if(Number.isNaN(Number(txt)))return toasts.showToast("Invalid app ID",assets.getAssetIDByName("Small"));applicationListCallback({id:txt})},cancelText:"Cancel"})},common.React.useEffect(function(){setSearch("")},[]),data||getApplications().then(setData);let wentBack=!1;return data?common.React.createElement(common.ReactNative.FlatList,{ListHeaderComponent:common.React.createElement(components.Search,{style:{marginBottom:10},onChangeText:function(x){return setSearch(x.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:data.filter(function(x){return x.name.toLowerCase().includes(search.toLowerCase())}),renderItem:function(x){const{item}=x;return common.React.createElement(common.ReactNative.TouchableOpacity,{onPress:function(){wentBack||(wentBack=!0,navigation.goBack(),applicationListCallback?.({id:item.id,name:item.name}))}},common.React.createElement(View$5,{style:{marginHorizontal:8,marginBottom:8,flexDirection:"row"}},common.React.createElement(Image$2,{source:{uri:item.icon?`https://cdn.discordapp.com/app-icons/${item.icon}/${item.icon}.png?size=64`:placeholders.image},style:{borderRadius:8,resizeMode:"cover",aspectRatio:1}}),common.React.createElement(View$5,{style:{flexDirection:"column",marginLeft:8}},common.React.createElement(Text$1,{variant:"text-md/semibold",color:"TEXT_NORMAL"},item.name),common.React.createElement(Text$1,{variant:"text-sm/medium",color:"TEXT_MUTED",lineClamp:1},item.description))))}}):common.React.createElement(common.ReactNative.ActivityIndicator,{style:{flex:1}})};function showApplicationList(navigation){navigation.push("VendettaCustomPage",{render:ApplicationList,title:"Select Application",headerRight:function(){return common.React.createElement(SuperAwesomeIcon,{style:"header",icon:assets.getAssetIDByName("ic_custom_color"),onPress:function(){return headerRightCallback?.()}})}})}const TabletManagerIdk=metro.findByProps("isTablet"),{View:View$4,Text,Image:Image$1}=components.General,styles$2=common.stylesheet.createThemedStyleSheet({card:{backgroundColor:ui.semanticColors.BACKGROUND_SECONDARY,marginHorizontal:4,marginVertical:4,borderRadius:8,flex:1},cardHeader:{backgroundColor:ui.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:8,borderTopRightRadius:8,paddingHorizontal:8,paddingVertical:8,width:"100%"},cardHeaderText:{...TextStyleSheet["text-sm/semibold"],color:ui.semanticColors.TEXT_NORMAL},cardImage:{width:"100%",flex:1,borderBottomLeftRadius:8,borderBottomRightRadius:8}}),RichAssetList=function(){const navigation=common.NavigationNative.useNavigation(),[search,setSearch]=common.React.useState(""),[data,setData]=common.React.useState();common.React.useEffect(function(){setSearch("")}),data||getApplicationAssets(richAssetListAppId).then(setData);let wentBack=!1;return data?common.React.createElement(common.ReactNative.FlatList,{ListEmptyComponent:common.React.createElement(components.Search,{style:{marginBottom:10},onChangeText:function(x){return setSearch(x.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:data.filter(function(x){return x.name.toLowerCase().includes(search)}),numColumns:TabletManagerIdk.isTablet?3:2,renderItem:function(x){const{item}=x;return common.React.createElement(common.ReactNative.TouchableOpacity,{onPress:function(){wentBack||(wentBack=!0,navigation.goBack(),richAssetListCallback?.(item.id))},style:{width:`${TabletManagerIdk.isTablet?1/.03:1/.02}%`,aspectRatio:1}},common.React.createElement(View$4,{style:styles$2.card},common.React.createElement(View$4,{style:styles$2.cardHeader},common.React.createElement(Text,{style:styles$2.cardHeaderText},item.name)),common.React.createElement(Image$1,{source:{uri:`https://cdn.discordapp.com/app-assets/${richAssetListAppId}/${item.id}.png?size=128`}})))}}):common.React.createElement(common.ReactNative.ActivityIndicator,{style:{flex:1}})};function showRichAssetList(navigation){navigation.push("VendettaCustomPage",{render:RichAssetList,title:"Select Asset"})}function stringifyTimeDiff(diff){const time=Math.abs(Math.floor(diff/1e3)),hrs=Math.floor(time/3600),mins=Math.floor(time/60)%60,secs=time%60;return`${hrs?`${hrs.toString().padStart(2,"0")}:`:""}${mins.toString().padStart(2,"0")}:${secs.toString().padStart(2,"0")}`}function parseTimestamp(timestamp){const hrs=Math.floor(timestamp/60),mins=timestamp%60;return new Date().setHours(hrs,mins,0,0)}function unparseTimestamp(timestamp){const date=new Date(timestamp);return date.getHours()*60+date.getMinutes()}function displayImage(image,appId){if(image.startsWith("spotify:"))return`https://i.scdn.co/image/${image.slice(8)}`;if(image.startsWith("mp:"))return`https://media.discordapp.net/${image.slice(3)}`;if(!Number.isNaN(Number(image)))return`https://cdn.discordapp.com/app-assets/${appId??"1"}/${image}.png?size=56`}const statusLinks={online:"mp:attachments/919655852724604978/1125529509723123712/s_online.png",idle:"mp:attachments/919655852724604978/1125529509467279451/s_idle.png",dnd:"mp:attachments/919655852724604978/1125529509236572301/s_dnd.png",offline:"mp:attachments/919655852724604978/1125529508980731954/s_offline.png"},UserStore$1=metro.findByStoreName("UserStore"),SpotifyStore=metro.findByStoreName("SpotifyStore"),PresenceStore=metro.findByStoreName("PresenceStore");var VariableType;(function(VariableType2){VariableType2[VariableType2.CurrentUser=0]="CurrentUser",VariableType2[VariableType2.CurrentUserPresence=1]="CurrentUserPresence"})(VariableType||(VariableType={}));const varCache={presence:{status:void 0,custom:void 0,spotify:null}},getCustomActivity=function(from){return(from??PresenceStore.getActivities(UserStore$1.getCurrentUser().id)).find(function(x){return x.type===4})},stringVariables=[{match:"{user.name}",description:"Your username",types:[0],replace:function(){return UserStore$1.getCurrentUser().username}},{match:"{user.displayname}",description:"Your display name",types:[0],replace:function(){return UserStore$1.getCurrentUser().globalName}},{match:"{user.status}",description:"Your status",types:[1],replace:function(){var _getCustomActivity;return((_getCustomActivity=getCustomActivity())===null||_getCustomActivity===void 0?void 0:_getCustomActivity.label)??"No Status"}},{match:"{user.presence}",description:"Your presence (online/dnd/idle/invisible)",types:[1],replace:function(){return PresenceStore.getStatus(UserStore$1.getCurrentUser().id)}},{match:"{spotify.track}",description:"Your playing Spotify track",types:[1],replace:function(){var _SpotifyStore_getActivity;return((_SpotifyStore_getActivity=SpotifyStore.getActivity())===null||_SpotifyStore_getActivity===void 0?void 0:_SpotifyStore_getActivity.details)??"No Spotify Track"}},{match:"{spotify.track.url}",description:"Your playing Spotify track's share link",types:[1],replace:function(){var _SpotifyStore_getActivity;const track=(_SpotifyStore_getActivity=SpotifyStore.getActivity())===null||_SpotifyStore_getActivity===void 0?void 0:_SpotifyStore_getActivity.sync_id;return track?`https://open.spotify.com/track/${track}`:""}},{match:"{spotify.artist}",description:"Your playing Spotify track's artist(s)",types:[1],replace:function(){var _this;return((_this=varCache.presence.spotify=SpotifyStore.getActivity())===null||_this===void 0?void 0:_this.state)??"No Spotify Track"}},{match:"{spotify.album}",description:"Your playing Spotify track's album",types:[1],replace:function(){var _assets,_this;return((_this=varCache.presence.spotify=SpotifyStore.getActivity())===null||_this===void 0||(_assets=_this.assets)===null||_assets===void 0?void 0:_assets.large_text)??"No Spotify Track"}}];function parseVariableString(str){const data={content:str,types:[]};for(const x of stringVariables){let rep;data.content=data.content.replaceAll(x.match,function(){for(const y of x.types)data.types.includes(y)||data.types.push(y);return rep??(rep=x.replace())})}return data}const timestampVariables=[{title:"Spotify Track Start",description:"The timestamp when your playing Spotify track started",format:"spotify.track.start",type:1,replace:function(){var _timestamps,_this;return(_this=varCache.presence.spotify=SpotifyStore.getActivity())===null||_this===void 0||(_timestamps=_this.timestamps)===null||_timestamps===void 0?void 0:_timestamps.start}},{title:"Spotify Track End",description:"The timestamp when your playing Spotify track ends",format:"spotify.track.end",type:1,replace:function(){var _timestamps,_this;return(_this=varCache.presence.spotify=SpotifyStore.getActivity())===null||_this===void 0||(_timestamps=_this.timestamps)===null||_timestamps===void 0?void 0:_timestamps.end}}];function parseVariableTimestamp(timestamp){if(typeof timestamp=="string"){const varib=timestampVariables.find(function(x){return x.format===timestamp}),rep=varib?.replace();return varib?{timestamp:rep!==void 0?unparseTimestamp(rep):void 0,type:varib.type}:{timestamp:0}}else return{timestamp}}const imageVariables=[{title:"User Avatar",description:"Your avatar",format:"user.avatar",type:0,replace:function(){const user=UserStore$1.getCurrentUser(),url=getUserAvatar({discriminator:user.discriminator,id:user.id,avatar:user.avatar});return proxyAssetCache[url]||getExternalAsset(url).then(forceUpdateActivity),`mp:${proxyAssetCache[url]}`}},{title:"User Presence",description:"Your presence (online/idle/dnd/invisible)",format:"user.presence",type:1,replace:function(){return statusLinks[PresenceStore.getStatus(UserStore$1.getCurrentUser().id)]??statusLinks.online}},{title:"Spotify Album Cover",description:"Your playing Spotify track's album cover",format:"spotify.album",type:1,replace:function(){var _SpotifyStore_getActivity_assets,_SpotifyStore_getActivity;return(_SpotifyStore_getActivity=SpotifyStore.getActivity())===null||_SpotifyStore_getActivity===void 0||(_SpotifyStore_getActivity_assets=_SpotifyStore_getActivity.assets)===null||_SpotifyStore_getActivity_assets===void 0?void 0:_SpotifyStore_getActivity_assets.large_image}}];function parseVariableImage(image){const varib=imageVariables.find(function(x){return x.format===image});return varib?{image:varib.replace(),type:varib.type}:{image}}function registerVariableEvents(types){for(const x of types)x===0?registerChangeFluxEvent("parsed.currentuser","CURRENT_USER_UPDATE",forceUpdateActivity):x===1&&registerChangeFluxEvent("parsed.currentuserpresence","SELF_PRESENCE_STORE_UPDATE",function(x2){(varCache.presence.status!==x2.status||JSON.stringify(varCache.presence.custom)!==JSON.stringify(getCustomActivity(x2.activities))||JSON.stringify(varCache.presence.spotify)!==JSON.stringify(SpotifyStore.getActivity()))&&forceUpdateActivity(),varCache.presence={status:x2.status,custom:getCustomActivity(x2.activities),spotify:SpotifyStore.getActivity()}})}const{View:View$3}=components.General,{FormRow:FormRow$2,FormRadioRow:FormRadioRow$1}=components.Forms,DatePicker=metro.findByProps("DatePickerModes"),SheetFooter=function(){return common.React.createElement(View$3,{style:{marginBottom:16}})},styles$1=common.stylesheet.createThemedStyleSheet({destructiveIcon:{tintColor:ui.semanticColors.TEXT_DANGER}}),destructiveText={color:"TEXT_DANGER",variant:"text-md/semibold"};function ImageVariableActionSheet(param){let{role,update}=param;return common.React.createElement(ActionSheet,null,common.React.createElement(ActionSheetContentContainer,null,common.React.createElement(ActionSheetTitleHeader,{title:`${role} Image Variable`,trailing:common.React.createElement(ActionSheetCloseButton,{onPress:function(){return hideActionSheet()}})}),imageVariables.map(function(x){return common.React.createElement(FormRow$2,{label:x.title,subLabel:x.description,trailing:common.React.createElement(FormRow$2.Arrow,null),onPress:function(){update(x.format),hideActionSheet()}})})))}let richAssetListCallback,richAssetListAppId;function ImageActionSheet(param){let{appId,role,image,navigation,update}=param;return common.React.createElement(ActionSheet,null,common.React.createElement(ActionSheetContentContainer,null,common.React.createElement(ActionSheetTitleHeader,{title:`Edit ${role} Image`,trailing:common.React.createElement(ActionSheetCloseButton,{onPress:hideActionSheet})}),common.React.createElement(FormRow$2,{label:"Set Image Variable",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_essentials_sparkle")}),trailing:common.React.createElement(FormRow$2.Arrow,null),onPress:function(){return openSheet(ImageVariableActionSheet,{role,update:function(v){return update(v)}})}}),common.React.createElement(FormRow$2,{label:"Use Custom Image",subLabel:"Make sure your image is in a square aspect ratio",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_link")}),onPress:function(){alerts.showInputAlert({title:"Enter the link to your image link",placeholder:"can be a discord attachment CDN link",confirmText:"Proxy",confirmColor:"brand",onConfirm:async function(d){var _d_match;const url=(_d_match=d.match(_vendetta.constants.HTTP_REGEX_MULTI))===null||_d_match===void 0?void 0:_d_match[0];if(!url)return toasts.showToast("Invalid URL",assets.getAssetIDByName("Small"));toasts.showToast("Proxying image...",assets.getAssetIDByName("ic_clock"));try{update(`mp:${await getExternalAsset(url)}`),toasts.showToast("Proxied image",assets.getAssetIDByName("Check"))}catch(p){console.error("[CustomRPC] ImageActionSheet->customImg proxy error!"),_vendetta.logger.error(`ImageActionSheet->customImg proxy error!
${p.stack}`),toasts.showToast("Failed to proxy image",assets.getAssetIDByName("Small"))}},cancelText:"Cancel"})}}),common.React.createElement(FormRow$2,{label:"Select RPC Asset",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_media_channel")}),trailing:common.React.createElement(FormRow$2.Arrow,null),onPress:function(){if(!appId)return alerts.showConfirmationAlert({title:"No App Set",content:"An app must be selected in order to use RPC assets",confirmText:"Dismiss",confirmColor:"grey",onConfirm:function(){}});richAssetListAppId=appId,richAssetListCallback=function(x){richAssetListCallback=void 0,update(x)},showRichAssetList(navigation),hideActionSheet()}}),image&&common.React.createElement(FormRow$2,{label:common.React.createElement(Text$1,destructiveText,"Remove Image"),leading:common.React.createElement(FormRow$2.Icon,{style:styles$1.destructiveIcon,source:assets.getAssetIDByName("trash")}),onPress:function(){update(void 0),hideActionSheet()}})))}function ButtonActionSheet(param){let{role,text,url,update}=param;return common.React.createElement(ActionSheet,null,common.React.createElement(ActionSheetTitleHeader,{title:`Edit Button ${role}`,trailing:common.React.createElement(ActionSheetCloseButton,{onPress:hideActionSheet})}),common.React.createElement(ActionSheetContentContainer,null,common.React.createElement(FormRow$2,{label:"Button Text",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),onPress:function(){return simpleInput({role:`Button ${role} Text`,current:text,update:function(x){return update({text:x,url})}})}}),common.React.createElement(FormRow$2,{label:"Button URL",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),onPress:function(){return simpleInput({role:`Button ${role} URL`,current:url,update:function(x){return update({text,url:x})}})}}),url&&common.React.createElement(FormRow$2,{label:common.React.createElement(Text$1,destructiveText,"Remove Button URL"),leading:common.React.createElement(FormRow$2.Icon,{style:styles$1.destructiveIcon,source:assets.getAssetIDByName("trash")}),onPress:function(){update({text,url:void 0}),hideActionSheet()}}),text&&common.React.createElement(FormRow$2,{label:common.React.createElement(Text$1,destructiveText,"Remove Button"),leading:common.React.createElement(FormRow$2.Icon,{style:styles$1.destructiveIcon,source:assets.getAssetIDByName("trash")}),onPress:function(){update({text:void 0,url:void 0}),hideActionSheet()}})))}let applicationListCallback;function ApplicationActionSheet(param){let{appId,appName,navigation,update}=param;return common.React.createElement(ActionSheet,null,common.React.createElement(ActionSheetContentContainer,null,common.React.createElement(ActionSheetTitleHeader,{title:"Edit Application",trailing:common.React.createElement(ActionSheetCloseButton,{onPress:hideActionSheet})}),common.React.createElement(FormRow$2,{label:"Application Name",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),onPress:function(){return simpleInput({role:"Application Name",current:appName,update:function(txt){return update({id:appId,name:txt})}})}}),common.React.createElement(FormRow$2,{label:"Select Application",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_robot_24px")}),trailing:common.React.createElement(FormRow$2.Arrow,null),onPress:function(){applicationListCallback=function(props){applicationListCallback=void 0,update({id:props.id??appId,name:props.name??appName})},showApplicationList(navigation),hideActionSheet()}}),appId&&common.React.createElement(FormRow$2,{label:common.React.createElement(Text$1,destructiveText,"Remove Application"),leading:common.React.createElement(FormRow$2.Icon,{style:styles$1.destructiveIcon,source:assets.getAssetIDByName("trash")}),onPress:function(){update(void 0),hideActionSheet()}})))}function ActivityTypeActionSheet(param){let{type,update}=param;const[val,setVal]=common.React.useState(type);return common.React.createElement(ActionSheet,null,common.React.createElement(ActionSheetContentContainer,null,common.React.createElement(ActionSheetTitleHeader,{title:"Edit Activity Type",trailing:common.React.createElement(ActionSheetCloseButton,{onPress:function(){return hideActionSheet()}})}),...Object.values(ActivityType).filter(function(x){return typeof x=="number"}).map(function(x){return common.React.createElement(FormRadioRow$1,{label:activityTypePreview[x],trailing:common.React.createElement(FormRow$2.Arrow,null),selected:x===val,onPress:function(){update(x),setVal(x)}})})))}function TimestampVariableActionSheet(param){let{role,update}=param;return common.React.createElement(ActionSheet,null,common.React.createElement(ActionSheetContentContainer,null,common.React.createElement(ActionSheetTitleHeader,{title:`Set ${role} Time Variable`,trailing:common.React.createElement(ActionSheetCloseButton,{onPress:function(){return hideActionSheet()}})}),timestampVariables.map(function(x){return common.React.createElement(FormRow$2,{label:x.title,subLabel:x.description,trailing:common.React.createElement(FormRow$2.Arrow,null),onPress:function(){update(x.format),hideActionSheet()}})})),common.React.createElement(SheetFooter,null))}function TimestampActionSheet(param){let{start,end,update}=param;const prompt=function(param2){let{role,onSubmit}=param2;const sOD=new Date().setHours(0,0,0,0),eOD=new Date().setHours(23,59,59,999);openLazy(Promise.resolve(DatePicker),"DatePicker",{onSubmit:function(x){return onSubmit(unparseTimestamp(x._d.getTime()))},title:`Timestamp ${role} Time`,startDate:new Date,minimumDate:new Date(sOD),maximumDate:new Date(eOD),requireDateChanged:!1,mode:"time"})};return common.React.createElement(ActionSheet,null,common.React.createElement(ActionSheetContentContainer,null,common.React.createElement(ActionSheetTitleHeader,{title:"Edit Timestamp",trailing:common.React.createElement(ActionSheetCloseButton,{onPress:function(){return hideActionSheet()}})}),common.React.createElement(FormRow$2,{label:"Set Start Time Variable",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_essentials_sparkle")}),trailing:common.React.createElement(FormRow$2.Arrow,null),onPress:function(){return openSheet(TimestampVariableActionSheet,{role:"Start",update:function(v){return update({start:v,end})}})}}),typeof start!="string"&&common.React.createElement(FormRow$2,{label:"Edit Start Time",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),trailing:common.React.createElement(FormRow$2.Arrow,null),onPress:function(){return prompt({role:"Start",onSubmit:function(v){return update({start:v,end})}})}}),start!==void 0&&common.React.createElement(FormRow$2,{label:common.React.createElement(Text$1,destructiveText,"Remove Start Time"),leading:common.React.createElement(FormRow$2.Icon,{style:styles$1.destructiveIcon,source:assets.getAssetIDByName("trash")}),onPress:function(){update({start:void 0,end}),hideActionSheet()}}),common.React.createElement(FormRow$2,{label:"Set End Time Variable",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_essentials_sparkle")}),trailing:common.React.createElement(FormRow$2.Arrow,null),onPress:function(){return openSheet(TimestampVariableActionSheet,{role:"End",update:function(v){return update({start,end:v})}})}}),typeof end!="string"&&common.React.createElement(FormRow$2,{label:"Edit End Time",leading:common.React.createElement(FormRow$2.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),onPress:function(){return prompt({role:"End",onSubmit:function(v){return update({start,end:v})}})}}),end!==void 0&&common.React.createElement(FormRow$2,{label:common.React.createElement(Text$1,destructiveText,"Remove End Time"),leading:common.React.createElement(FormRow$2.Icon,{style:styles$1.destructiveIcon,source:assets.getAssetIDByName("trash")}),onPress:function(){update({start,end:void 0}),hideActionSheet()}})))}const activitySavedPrompt=function(param){let{role,button,secondaryButton,run,secondaryRun}=param;if(isActivitySaved())return run();alerts.showConfirmationAlert({title:"Unsaved Changes",content:["You have unsaved changes in ",common.React.createElement(RichText.Bold,null,vstorage.activity.profile),`. Are you sure you want to ${role}?`],confirmText:button,confirmColor:"red",onConfirm:run,secondaryConfirmText:secondaryButton,onConfirmSecondary:function(){secondaryRun?.(),run?.()},cancelText:"Cancel"})},simpleInput=function(param){let{role,current,update}=param;return alerts.showInputAlert({title:`Enter New ${role}`,initialValue:current,placeholder:`really cool ${role.toLowerCase()}`,confirmText:"Change",confirmColor:"brand",onConfirm:update,cancelText:"Cancel"})},UserStore=metro.findByStoreName("UserStore"),{View:View$2,Image,Pressable}=components.General,UserActivityContainer=metro.findByName("UserActivityContainer"),styles=common.stylesheet.createThemedStyleSheet({actTypeCont:{flexDirection:"row",marginBottom:12,justifyContent:"space-between"},card:{borderWidth:1,borderRadius:8,borderColor:ui.semanticColors.BACKGROUND_MODIFIER_ACCENT},card2:{alignItems:"flex-start",flexDirection:"row"},images:{position:"relative",marginRight:10},smallImageBg:{borderColor:ui.semanticColors.BACKGROUND_PRIMARY,backgroundColor:ui.semanticColors.BACKGROUND_PRIMARY,borderWidth:1,borderRadius:18,position:"absolute",right:-4,bottom:-4}});let forceUpdateRPCPreview;function RPCPreview(param){let{edit,act}=param;var _act_buttons_,_act_buttons_1;const[_,forceUpdate]=common.React.useReducer(function(x){return~x},0);forceUpdateRPCPreview=forceUpdate;const navigation=common.NavigationNative.useNavigation(),update=function(){forceUpdate(),forceUpdateSettings?.()};return edit?common.React.createElement(common.React.Fragment,null,common.React.createElement(View$2,{style:styles.actTypeCont},common.React.createElement(Text$1,{variant:"eyebrow",color:"TEXT_NORMAL",onPress:function(){return openSheet(ActivityTypeActionSheet,{type:act.type??ActivityType.Playing,update:function(x){act.type=x,update()}})}},activityTypePreview[act.type??ActivityType.Playing]," ...")),common.React.createElement(View$2,{style:styles.card},common.React.createElement(View$2,{style:{padding:16}},common.React.createElement(View$2,{style:styles.card2},common.React.createElement(View$2,{style:styles.images},common.React.createElement(Pressable,{onPress:function(){return openSheet(ImageActionSheet,{appId:act.app.id,role:"Large",image:act.assets.largeImg,navigation,update:function(x){act.assets.largeImg=x,update()}})}},common.React.createElement(Image,{source:{uri:displayImage(act.assets.largeImg??".",act.app.id)??placeholders.image},style:{borderRadius:3,width:56,height:56}})),common.React.createElement(View$2,{style:styles.smallImageBg},common.React.createElement(Pressable,{onPress:function(){return openSheet(ImageActionSheet,{appId:act.app.id,role:"Small",image:act.assets.smallImg,navigation,update:function(x){act.assets.smallImg=x,update()}})}},common.React.createElement(Image,{source:{uri:displayImage(act.assets.smallImg??".",act.app.id)??placeholders.image},style:{borderRadius:14,width:28,height:28}})))),common.React.createElement(View$2,{style:{flex:1}},common.React.createElement(Text$1,{variant:"text-md/semibold",color:"TEXT_NORMAL",onPress:function(){return openSheet(ApplicationActionSheet,{appId:act.app.id,appName:act.app.name,navigation,update:function(x){x?.id!==act.app.id&&(Number.isNaN(Number(act.assets.smallImg))||delete act.assets.smallImg,Number.isNaN(Number(act.assets.largeImg))||delete act.assets.largeImg),act.app.id=x?.id,act.app.name=x?.name,update()}})}},act.app.name??placeholders.appName),common.React.createElement(Text$1,{variant:"text-sm/normal",color:"TEXT_NORMAL",onPress:function(){return simpleInput({role:"Details",current:act.details,update:function(x){act.details=x,update()}})}},act.details??placeholders.details),common.React.createElement(Text$1,{variant:"text-sm/normal",color:"TEXT_NORMAL",onPress:function(){return simpleInput({role:"State",current:act.state,update:function(x){act.state=x,update()}})}},act.state??placeholders.state),common.React.createElement(Text$1,{variant:"text-sm/normal",color:"TEXT_NORMAL",onPress:function(){return openSheet(TimestampActionSheet,{start:act.timestamps.start,end:act.timestamps.end,update:function(x){act.timestamps.start=x.start,act.timestamps.end=x.end,update()}})},liveUpdate:!0,getChildren:function(){return typeof act.timestamps.end=="string"?`{${act.timestamps.end}}`:typeof act.timestamps.end=="number"?`${stringifyTimeDiff(parseTimestamp(act.timestamps.end)-Date.now())} left`:typeof act.timestamps.start=="string"?`{${act.timestamps.start}}`:typeof act.timestamps.start=="number"?`${stringifyTimeDiff(Date.now()-parseTimestamp(act.timestamps.start))} elapsed`:placeholders.timestamp}}))),common.React.createElement(View$2,{style:{marginTop:16}},common.React.createElement(components.Button,{text:((_act_buttons_=act.buttons[0])===null||_act_buttons_===void 0?void 0:_act_buttons_.text)??placeholders.button1,style:{backgroundColor:"grey"},size:"small",onPress:function(){var _act_buttons_2,_act_buttons_12;return openSheet(ButtonActionSheet,{role:"1",text:(_act_buttons_2=act.buttons[0])===null||_act_buttons_2===void 0?void 0:_act_buttons_2.text,url:(_act_buttons_12=act.buttons[0])===null||_act_buttons_12===void 0?void 0:_act_buttons_12.url,update:function(param2){let{text,url}=param2;!text&&!url?act.buttons[0]=void 0:act.buttons[0]={text,url},update()}})}})),common.React.createElement(View$2,{style:{marginTop:10}},common.React.createElement(components.Button,{text:((_act_buttons_1=act.buttons[1])===null||_act_buttons_1===void 0?void 0:_act_buttons_1.text)??placeholders.button2,style:{backgroundColor:"grey"},size:"small",onPress:function(){var _act_buttons_2,_act_buttons_12;return openSheet(ButtonActionSheet,{role:"2",text:(_act_buttons_2=act.buttons[1])===null||_act_buttons_2===void 0?void 0:_act_buttons_2.text,url:(_act_buttons_12=act.buttons[1])===null||_act_buttons_12===void 0?void 0:_act_buttons_12.url,update:function(param2){let{text,url}=param2;!text&&!url?act.buttons[1]=void 0:act.buttons[1]={text,url},update()}})}}))))):common.React.createElement(UserActivityContainer,{user:UserStore.getCurrentUser(),activity:settingsActivityToRaw(act).activity})}const cronjobs={};function registerChangeCronJob(key,cron,run,isDefault){if(cronjobs[key])return;const change={default:isDefault,timeout:-1};cronjobs[key]=change;const thing=function(){const next=cron(new Date);change.timeout=setTimeout(function(){run(),thing()},next-Date.now())};thing()}const fluxEvents={};function registerChangeFluxEvent(key,event,run,isDefault){fluxEvents[key]||(common.FluxDispatcher.subscribe(event,run),fluxEvents[key]={default:isDefault,event,handler:run})}function unregisterChanges(everything){for(const[x,y]of Object.entries(cronjobs))(everything||!y.default)&&(clearTimeout(y.timeout),delete cronjobs[x]);for(const[x,y]of Object.entries(fluxEvents))(everything||!y.default)&&(common.FluxDispatcher.unsubscribe(y.event,y.handler),delete fluxEvents[x])}function registerDefaultChanges(){registerChangeCronJob("auto_fix_timestamps",function(x){return x.setHours(24,0,0,0)},forceUpdateActivity,!0)}function forceUpdateActivity(){forceUpdateRPCPreview?.(),dispatchActivityIfPossible()}var ActivityType;(function(ActivityType2){ActivityType2[ActivityType2.Playing=0]="Playing",ActivityType2[ActivityType2.Listening=2]="Listening",ActivityType2[ActivityType2.Watching=3]="Watching",ActivityType2[ActivityType2.Competing=5]="Competing"})(ActivityType||(ActivityType={}));const SettingsActivity=Joi.object({app:Joi.object({name:Joi.string().optional(),id:Joi.string().optional()}),state:Joi.string().optional(),details:Joi.string().optional(),timestamps:Joi.object({start:Joi.alternatives(Joi.string(),Joi.number()).optional(),end:Joi.alternatives(Joi.string(),Joi.number()).optional()}),assets:Joi.object({largeImg:Joi.string().optional(),smallImg:Joi.string().optional()}),buttons:[Joi.object({text:Joi.string(),url:Joi.string().optional()})],type:Joi.string().valid(...Object.values(ActivityType))});var ActivityFlags;(function(ActivityFlags2){ActivityFlags2[ActivityFlags2.Instance=1]="Instance",ActivityFlags2[ActivityFlags2.Join=2]="Join",ActivityFlags2[ActivityFlags2.Spectate=4]="Spectate",ActivityFlags2[ActivityFlags2.JoinRequest=8]="JoinRequest",ActivityFlags2[ActivityFlags2.Sync=16]="Sync",ActivityFlags2[ActivityFlags2.Play=32]="Play",ActivityFlags2[ActivityFlags2.PartyPrivacyFriends=64]="PartyPrivacyFriends",ActivityFlags2[ActivityFlags2.PartyPrivacyVoiceChannel=128]="PartyPrivacyVoiceChannel",ActivityFlags2[ActivityFlags2.Embedded=256]="Embedded"})(ActivityFlags||(ActivityFlags={}));function makeEmptySettingsActivity(){return{timestamps:{},assets:{},buttons:[],app:{}}}function settingsActivityToRaw(activity){const types=[],handleVar={str:function(str){const vr=parseVariableString(str);for(const x of vr.types)types.includes(x)||types.push(x);return vr.content},tim:function(tim){const vr=parseVariableTimestamp(tim);return vr.type&&!types.includes(vr.type)&&types.push(vr.type),vr.timestamp!==void 0?parseTimestamp(vr.timestamp):void 0},img:function(img){const vr=parseVariableImage(img);return vr.type&&!types.includes(vr.type)&&types.push(vr.type),vr.image}},at={name:handleVar.str(activity.app.name??placeholders.appName),application_id:activity.app.id??"0",type:activity.type??0,flags:1,state:activity.state&&handleVar.str(activity.state),details:activity.details&&handleVar.str(activity.details),timestamps:{start:activity.timestamps.start!==void 0?handleVar.tim(activity.timestamps.start):void 0,end:activity.timestamps.end!==void 0?handleVar.tim(activity.timestamps.end):void 0},assets:{large_image:activity.assets.largeImg&&handleVar.img(activity.assets.largeImg),small_image:activity.assets.smallImg&&handleVar.img(activity.assets.smallImg)}};return at.assets.large_image&&at.type===0&&(at.assets.large_text="CRPC@VD"),activity.buttons[0]&&(at.metadata={button_urls:activity.buttons.slice(0,2).filter(function(x){return!!x.text}).map(function(x){return x.url?handleVar.str(x.url):null})},at.buttons=activity.buttons.slice(0,2).filter(function(x){return!!x.text}).map(function(x){return handleVar.str(x.text)})),debug.lastRawActivity=at,debug.lastRawActivityTimestamp=Date.now(),forceUpdateLiveRawActivityView?.(),{activity:at,types}}async function dispatchActivity(activity){let send={};if(unregisterChanges(),activity){const parsed=settingsActivityToRaw(activity);send=parsed.activity,registerVariableEvents(parsed.types)}common.FluxDispatcher.dispatch({type:"LOCAL_ACTIVITY_UPDATE",activity:send,socketId:"CustomRPC@Nexpid/Bunny"})}function getSavedActivity(){var _vstorage_activity,_vstorage_profiles,_vstorage_activity1;return((_vstorage_profiles=vstorage.profiles)===null||_vstorage_profiles===void 0?void 0:_vstorage_profiles[(_vstorage_activity=vstorage.activity)===null||_vstorage_activity===void 0?void 0:_vstorage_activity.profile])??((_vstorage_activity1=vstorage.activity)===null||_vstorage_activity1===void 0?void 0:_vstorage_activity1.editing)??makeEmptySettingsActivity()}function dispatchActivityIfPossible(){var _vstorage_settings;const activity=getSavedActivity();!((_vstorage_settings=vstorage.settings)===null||_vstorage_settings===void 0)&&_vstorage_settings.display?dispatchActivity(activity):dispatchActivity()}function isActivitySaved(){const a=getSavedActivity();return JSON.stringify(a)===JSON.stringify(vstorage.activity.editing)}const{View:View$1}=components.General,{FormRadioRow,FormRow:FormRow$1}=components.Forms,{showSimpleActionSheet}=metro.findByProps("showSimpleActionSheet"),LazyActionSheet=metro.findByProps("openLazy","hideActionSheet"),headerRightCallbacks={import:void 0,add:void 0},ProfileList=function(){const navigation=common.NavigationNative.useNavigation(),[_,forceUpdate]=common.React.useReducer(function(x){return~x},0),[search,setSearch]=common.React.useState("");common.React.useEffect(function(){setSearch("")},[]),headerRightCallbacks.add=function(){return alerts.showInputAlert({title:"Enter new profile name",placeholder:"Super Awesome RPC",confirmText:"Add",confirmColor:"brand",onConfirm:function(txt){if(txt.match(/^\s*$/))return toasts.showToast("Profile name cannot be empty",assets.getAssetIDByName("Small"));if(txt=txt.trim(),vstorage.profiles[txt])return toasts.showToast("A profile with that name already exists",assets.getAssetIDByName("Small"));vstorage.profiles[txt]=JSON.parse(JSON.stringify(vstorage.activity.editing)),vstorage.activity.profile=txt,forceUpdate(),toasts.showToast("Created profile",assets.getAssetIDByName("Check"))},cancelText:"Cancel"})},headerRightCallbacks.import=async function(){let activity;try{activity=JSON.parse(await common.clipboard.getString())}catch{return toasts.showToast("Failed to parse JSON")}const data=SettingsActivity.validate(activity);if(data.error)return toasts.showToast("Invalid profile data",assets.getAssetIDByName("Small"));let counter=0,name="Imported Profile";for(;vstorage.profiles[name];)counter++,name=`Imported Profile (${counter})`;vstorage.profiles[name]=data.value,vstorage.activity.profile=name,forceUpdate(),toasts.showToast("Imported profile",assets.getAssetIDByName("Check"))};let wentBack=!1;return common.React.createElement(common.ReactNative.FlatList,{ListHeaderComponent:common.React.createElement(components.Search,{style:{marginBottom:10},onChangeText:function(txt){return setSearch(txt.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.keys(vstorage.profiles).filter(function(x){return x.toLowerCase().includes(search)}),renderItem:function(param){let{item}=param;return common.React.createElement(FormRadioRow,{label:item,onLongPress:function(){return showSimpleActionSheet({key:"CardOverflow",header:{title:item,onClose:function(){return LazyActionSheet.hideActionSheet()}},options:[{label:"Copy Profile",icon:assets.getAssetIDByName("copy"),onPress:function(){common.clipboard.setString(JSON.stringify(vstorage.profiles[item],void 0,3)),toasts.showToast("Copied",assets.getAssetIDByName("toast_copy_link"))}},{label:"Rename Profile",icon:assets.getAssetIDByName("ic_message_edit"),onPress:function(){return alerts.showInputAlert({title:"Enter new profile name",placeholder:"Super Awesome RPC 2.0",initialValue:item,confirmText:"Rename",confirmColor:"brand",onConfirm:function(txt){if(txt.match(/^\s*$/))return toasts.showToast("Profile name cannot be empty",assets.getAssetIDByName("Small"));if(txt=txt.trim(),vstorage.profiles[txt])return toasts.showToast("A profile with that name already exists",assets.getAssetIDByName("Small"));vstorage.profiles[txt]=vstorage.profiles[item],vstorage.activity.profile===item&&(vstorage.activity.profile=txt),delete vstorage.profiles[item],forceUpdate(),toasts.showToast("Renamed profile",assets.getAssetIDByName("Check"))},cancelText:"Cancel"})}},{label:"Delete Profile",icon:assets.getAssetIDByName("trash"),isDestructive:!0,onPress:function(){return alerts.showConfirmationAlert({title:"Delete Profile",content:"Are you sure you want to delete this profile? This cannot be undone.",confirmText:"Delete",confirmColor:"red",onConfirm:function(){vstorage.activity.profile===item&&(delete vstorage.activity.profile,vstorage.activity.editing=makeEmptySettingsActivity()),delete vstorage.profiles[item],forceUpdate(),forceUpdateSettings?.(),toasts.showToast("Deleted",assets.getAssetIDByName("Check"))},cancelText:"Cancel"})}}]})},onPress:function(){if(!wentBack){if(vstorage.activity.profile===item)return toasts.showToast(`${item} is already loaded`,assets.getAssetIDByName("Small"));activitySavedPrompt({role:"discard your changes",button:"Discard",run:function(){vstorage.activity.editing=JSON.parse(JSON.stringify(vstorage.profiles[item])),vstorage.activity.profile=item,wentBack=!0,navigation.goBack(),forceUpdateSettings?.(),toasts.showToast("Loaded",assets.getAssetIDByName("Check"))},secondaryButton:"Save profile",secondaryRun:function(){vstorage.profiles[vstorage.activity.profile]=JSON.parse(JSON.stringify(vstorage.activity.editing))}})}},trailing:common.React.createElement(FormRow$1.Arrow,null),selected:vstorage.activity.profile===item})}})};function showProfileList(navigation){navigation.push("VendettaCustomPage",{render:ProfileList,title:"Profiles",headerRight:function(){return common.React.createElement(View$1,{style:{flexDirection:"row-reverse"}},common.React.createElement(SuperAwesomeIcon,{style:"header",icon:assets.getAssetIDByName("ic_add_24px"),onPress:function(){var _headerRightCallbacks_add;return(_headerRightCallbacks_add=headerRightCallbacks.add)===null||_headerRightCallbacks_add===void 0?void 0:_headerRightCallbacks_add.call(headerRightCallbacks)}}),common.React.createElement(SuperAwesomeIcon,{style:"header",icon:assets.getAssetIDByName("ic_file_upload_24px"),onPress:function(){var _headerRightCallbacks_import;return(_headerRightCallbacks_import=headerRightCallbacks.import)===null||_headerRightCallbacks_import===void 0?void 0:_headerRightCallbacks_import.call(headerRightCallbacks)}}))}})}const{ScrollView,View}=components.General,{FormSwitchRow,FormIcon,FormRow}=components.Forms,placeholders={image:"https://discord.com/assets/cb1043c312ec65507573c06c37f6ee63.gif",appName:"Enter App Name...",details:"Enter Details...",state:"Enter State...",timestamp:"Enter Timestamp...",button1:"Edit Button 1...",button2:"Edit Button 2..."},activityTypePreview={0:"Playing",2:"Listening to",3:"Watching",5:"Competing in"};let forceUpdateSettings;function settings(){const navigation=common.NavigationNative.useNavigation(),[_,forceUpdate]=common.React.useReducer(function(x){return~x},0);forceUpdateSettings=forceUpdate,storage.useProxy(vstorage),common.React.useEffect(function(){return vstorage.settings.display&&dispatchActivityIfPossible()},[JSON.stringify(vstorage.activity.editing),vstorage.settings.display]),managePage({headerRight:function(){return common.React.createElement(SuperAwesomeIcon,{style:"header",icon:assets.getAssetIDByName("SparklesIcon"),onPress:function(){return alerts.showConfirmationAlert({title:"String Variables",content:`String variables can be used in any text component
Here's the entire list:

${stringVariables.map(function(x){return`**\`${x.match}\`**
 \u2014 ${x.description}`}).join(`
`)}`,confirmText:"Dismiss",confirmColor:"brand",onConfirm:function(){}})}})}});let dbgCounter=0,dbgCounterTimeout;return common.React.createElement(common.React.Fragment,null,common.React.createElement(ScrollView,{style:{zIndex:1}},common.React.createElement(BetterTableRowGroup,{title:"Preview",onTitlePress:function(){if(vstorage.settings.debug.enabled)vstorage.settings.debug.visible=!vstorage.settings.debug.visible,toasts.showToast(`Debug tab ${vstorage.settings.debug.visible?"visible":"hidden"}`);else{if(dbgCounterTimeout&&clearTimeout(dbgCounterTimeout),dbgCounterTimeout=setTimeout(function(){dbgCounter=0},500),dbgCounter++,dbgCounter<2)return;if(dbgCounter<7){const more=7-dbgCounter;return toasts.showToast(`${more} more taps`)}else toasts.showToast("Behold! You can now debug!"),vstorage.settings.debug.visible=!0,vstorage.settings.debug.enabled=!0,forceUpdate()}},icon:assets.getAssetIDByName("ic_eye"),padding:vstorage.settings.edit},common.React.createElement(RPCPreview,{edit:vstorage.settings.edit,act:vstorage.activity.editing})),common.React.createElement(BetterTableRowGroup,{title:"Settings",icon:assets.getAssetIDByName("ic_cog_24px")},common.React.createElement(FormSwitchRow,{label:"Edit Mode",subLabel:"Be able to edit your activity",leading:common.React.createElement(FormIcon,{source:assets.getAssetIDByName("ic_badge_staff")}),onValueChange:function(){return vstorage.settings.edit=!vstorage.settings.edit},value:vstorage.settings.edit}),common.React.createElement(FormSwitchRow,{label:"Display Activity",subLabel:"Show off your super awesome poggers activity to the world",leading:common.React.createElement(FormIcon,{source:assets.getAssetIDByName("ic_show_password")}),onValueChange:function(){return vstorage.settings.display=!vstorage.settings.display},value:vstorage.settings.display})),common.React.createElement(BetterTableRowGroup,{title:"Data",icon:assets.getAssetIDByName("ic_feedback")},common.React.createElement(FormRow,{label:"Copy as JSON",leading:common.React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("copy")}),onPress:function(){common.clipboard.setString(JSON.stringify(vstorage.activity.editing,void 0,3)),toasts.showToast("Copied",assets.getAssetIDByName("toast_copy_link"))}}),common.React.createElement(FormRow,{label:"Load from Clipboard",leading:common.React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_download_24px")}),onPress:function(){return activitySavedPrompt({role:"overwrite the activity data",button:"Overwrite",run:async function(){let rawData;try{rawData=JSON.parse(await common.clipboard.getString())}catch{return toasts.showToast("Failed to parse JSON",assets.getAssetIDByName("Small"))}const data=SettingsActivity.validate(rawData);if(!data.error)return toasts.showToast("Invalid activity data",assets.getAssetIDByName("Small"));vstorage.activity.editing=data.value,delete vstorage.activity.profile,forceUpdate(),toasts.showToast("Loaded",assets.getAssetIDByName("Check"))}})}}),common.React.createElement(LineDivider,{addPadding:!0}),vstorage.activity.profile&&common.React.createElement(FormRow,{label:`Save Profile${isActivitySaved()?"":" \u{1F534}"}`,leading:common.React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),onPress:function(){vstorage.profiles[vstorage.activity.profile]=JSON.parse(JSON.stringify(vstorage.activity.editing)),toasts.showToast("Saved",assets.getAssetIDByName("Check")),forceUpdate()}}),vstorage.activity.profile&&common.React.createElement(FormRow,{label:"Revert Profile",leading:common.React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),onPress:function(){return activitySavedPrompt({role:"revert",button:"Revert",run:function(){vstorage.activity.editing=JSON.parse(JSON.stringify(vstorage.profiles[vstorage.activity.profile])),toasts.showToast("Reverted",assets.getAssetIDByName("Check")),forceUpdate()}})}}),vstorage.activity.profile&&common.React.createElement(FormRow,{label:"Close Profile",leading:common.React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),onPress:function(){return activitySavedPrompt({role:"discard your changes",button:"Discard",run:function(){vstorage.activity.editing=makeEmptySettingsActivity(),delete vstorage.activity.profile,toasts.showToast("Closed",assets.getAssetIDByName("Check")),forceUpdate()},secondaryButton:"Save profile",secondaryRun:function(){vstorage.profiles[vstorage.activity.profile]=JSON.parse(JSON.stringify(vstorage.activity.editing))}})}}),common.React.createElement(FormRow,{label:"Browse Profiles",leading:common.React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_message_edit")}),trailing:common.React.createElement(FormRow.Arrow,null),onPress:function(){return showProfileList(navigation)}})),vstorage.settings.debug.visible&&common.React.createElement(BetterTableRowGroup,{title:"Debug",icon:assets.getAssetIDByName("ic_progress_wrench_24px")},common.React.createElement(FormRow,{label:"Live RawActivity View",trailing:common.React.createElement(FormRow.Arrow,null),leading:common.React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_badge_staff")}),onPress:function(){return openLiveRawActivityView(navigation)}}),common.React.createElement(FormRow,{label:"Flush MP Cache",leading:common.React.createElement(FormRow.Icon,{source:assets.getAssetIDByName("ic_badge_staff")}),onPress:function(){let changes=0;for(const x of Object.keys(proxyAssetCache))changes++,delete proxyAssetCache[x];const faces=":P,:3,:D,:-D,:>,x3,xD,:x,:^),:v".split(",");toasts.showToast(`Flushed MP cache ${faces[Math.floor(Math.random()*faces.length)]}`),changes>0&&dispatchActivityIfPossible()}})),common.React.createElement(View,{style:{marginBottom:20}})))}//! for some reason the compiler breaks here and doesn't recognize ActivityType
const PresetProfiles={"Vendetta Advertisement":{state:"Join Now",details:'"The best Discord client for mobile"',app:{name:"Vendetta"},timestamps:{},assets:{largeImg:"mp:external/1Hoxz2ijw0uHYRKT1DDAYvEDsOTkOTT6Le4YIoX7Joo/%3Fsize%3D128/https/cdn.discordapp.com/icons/1015931589865246730/5f8c26072398178c3fb6868124eeef59.png"},type:3,buttons:[{text:"Join Vendetta",url:"https://discord.gg/vendetta-mod"},{text:"Install Vendetta",url:"https://github.com/vendetta-mod/Vendetta#installing"}]},"Scuffed Spotify Activity":{timestamps:{start:"spotify.track.start",end:"spotify.track.end"},assets:{smallImg:"user.avatar",largeImg:"spotify.album"},buttons:[{text:"Listen Along",url:"{spotify.track.url}"}],app:{name:"{spotify.track}"},type:2,details:"by {spotify.artist}",state:"on {spotify.album}"},"My Profile":{timestamps:{start:0},assets:{largeImg:"user.avatar",smallImg:"user.presence"},buttons:[],app:{name:"{user.displayname}"},type:3,details:"{user.name}",state:"{user.status}"}},vstorage=plugin.storage,debug={lastRawActivity:void 0,lastRawActivityTimestamp:void 0};var index={onLoad:async function(){vstorage.settings??(vstorage.settings={edit:!1,display:!1,debug:{enabled:!1,visible:!1}}),vstorage.activity??(vstorage.activity={editing:makeEmptySettingsActivity()}),vstorage.profiles??(vstorage.profiles=PresetProfiles),dispatchActivityIfPossible(),registerDefaultChanges()},onUnload:function(){dispatchActivity(),unregisterChanges(!0)},settings};return exports.debug=debug,exports.default=index,exports.vstorage=vstorage,Object.defineProperty(exports,"__esModule",{value:!0}),exports})({},vendetta.plugin,vendetta.metro.common,vendetta.storage,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.ui,vendetta,vendetta.metro,vendetta.utils);
